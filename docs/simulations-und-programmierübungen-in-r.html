<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Simulations- und Programmierübungen in R | Robustheit</title>
  <meta name="description" content="Seminar zur Vertiefung psychologischer Methodenlehre - Robustheit und Voraussetzungstests" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Simulations- und Programmierübungen in R | Robustheit" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Seminar zur Vertiefung psychologischer Methodenlehre - Robustheit und Voraussetzungstests" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Simulations- und Programmierübungen in R | Robustheit" />
  
  <meta name="twitter:description" content="Seminar zur Vertiefung psychologischer Methodenlehre - Robustheit und Voraussetzungstests" />
  

<meta name="author" content="Max Brede und Johannes Andres" />


<meta name="date" content="2021-12-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functionals.html"/>
<link rel="next" href="experimente-in-psychopy.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Robustheit und Voraussetzungstests</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Vorwort</a></li>
<li class="chapter" data-level="" data-path="lehrplan.html"><a href="lehrplan.html"><i class="fa fa-check"></i>Lehrplan</a>
<ul>
<li class="chapter" data-level="" data-path="lehrplan.html"><a href="lehrplan.html#semesterplan"><i class="fa fa-check"></i>Semesterplan</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="programmieren-in-r.html"><a href="programmieren-in-r.html"><i class="fa fa-check"></i>Programmieren in R</a></li>
<li class="chapter" data-level="" data-path="funktionen.html"><a href="funktionen.html"><i class="fa fa-check"></i>Funktionen</a>
<ul>
<li class="chapter" data-level="" data-path="funktionen.html"><a href="funktionen.html#geschachtelte-funktionen"><i class="fa fa-check"></i>Geschachtelte Funktionen</a></li>
<li class="chapter" data-level="" data-path="funktionen.html"><a href="funktionen.html#optionale-argumente"><i class="fa fa-check"></i>Optionale Argumente</a></li>
</ul></li>
<li><a href="if-statements.html#if-statements"><code>if</code>-Statements</a></li>
<li class="chapter" data-level="" data-path="zufallswerte.html"><a href="zufallswerte.html"><i class="fa fa-check"></i>Zufallswerte</a></li>
<li class="chapter" data-level="" data-path="schleifen.html"><a href="schleifen.html"><i class="fa fa-check"></i>Schleifen</a></li>
<li class="chapter" data-level="" data-path="listen.html"><a href="listen.html"><i class="fa fa-check"></i>Listen</a>
<ul>
<li class="chapter" data-level="" data-path="listen.html"><a href="listen.html#listen-und-datensätze"><i class="fa fa-check"></i>Listen und Datensätze</a></li>
<li class="chapter" data-level="" data-path="listen.html"><a href="listen.html#arbeiten-mit-listen"><i class="fa fa-check"></i>Arbeiten mit Listen</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="attribute.html"><a href="attribute.html"><i class="fa fa-check"></i>Attribute</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i>Functionals</a>
<ul>
<li><a href="functionals.html#purrrmap"><code>purrr::map</code></a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exkurs-iteratoren-vergleich-und-microbenchmarking"><i class="fa fa-check"></i>Exkurs: Iteratoren-Vergleich und Microbenchmarking</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#eigene-functionals"><i class="fa fa-check"></i>Eigene Functionals</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#argumente-durchreichen"><i class="fa fa-check"></i>Argumente durchreichen</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="simulations-und-programmierübungen-in-r.html"><a href="simulations-und-programmierübungen-in-r.html"><i class="fa fa-check"></i>Simulations- und Programmierübungen in R</a>
<ul>
<li class="chapter" data-level="" data-path="simulations-und-programmierübungen-in-r.html"><a href="simulations-und-programmierübungen-in-r.html#pascalsches-dreieck"><i class="fa fa-check"></i>Pascalsches Dreieck</a></li>
<li><a href="simulations-und-programmierübungen-in-r.html#matrizen-und-chi2">Matrizen und <span class="math inline">\(\chi^2\)</span></a></li>
<li class="chapter" data-level="" data-path="simulations-und-programmierübungen-in-r.html"><a href="simulations-und-programmierübungen-in-r.html#t-test"><i class="fa fa-check"></i>t-Test</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="experimente-in-psychopy.html"><a href="experimente-in-psychopy.html"><i class="fa fa-check"></i>Experimente in Psychopy</a>
<ul>
<li class="chapter" data-level="" data-path="experimente-in-psychopy.html"><a href="experimente-in-psychopy.html#stroop"><i class="fa fa-check"></i>Stroop</a></li>
<li class="chapter" data-level="" data-path="experimente-in-psychopy.html"><a href="experimente-in-psychopy.html#stroop-mit-bildern"><i class="fa fa-check"></i>Stroop mit Bildern</a></li>
<li class="chapter" data-level="" data-path="experimente-in-psychopy.html"><a href="experimente-in-psychopy.html#einlesen-von-mit-psychopy-gewonnenen-daten"><i class="fa fa-check"></i>Einlesen von mit Psychopy gewonnenen Daten</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="literatur.html"><a href="literatur.html"><i class="fa fa-check"></i>Literatur</a></li>
<li class="divider"></li>
<li><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Robustheit</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simulations--und-programmierübungen-in-r" class="section level1">
<h1>Simulations- und Programmierübungen in R</h1>
<p>Im Folgenden werden keine neuen Konzepte eingeführt, zum Üben der bisher eingeführten Konzepte werden aber eine Reihe von Aufgaben gestellt, die Schritt für Schritt mit statistischen Beispielen zu ersten eigenen und zunehmend komplexen Simulationen führen sollen.
Zu jeder Aufgabe wird auch eine Musterlösung angeboten, wie immer ist diese aber zum Einen nicht die einzig mögliche Lösung und zum Anderen bitte erst zu konsultieren, wenn eine eigene Lösung versucht wurde.
Der Lernfortschritt durch eigenes Programmieren (und Fehler machen) ist wesentlich größer als durch das einfache Lesen fertiger Skripte.</p>
<style>
pre.numberSource code > span > a:first-child::before {
  left: -0.3em;
}
</style>
<div id="pascalsches-dreieck" class="section level2">
<h2>Pascalsches Dreieck</h2>
<p>Das Ziel soll sein, eine Funktion namens <code>binom_mat</code> zu erstellen, die für eine gegebene Zahl n das Pascalsche Dreieck bis zur gegebenen Größe zurückgibt.
Dieses Dreieck soll erstmal als Matrix zurückgegeben werden, die für die Zahl 5 zum Beispiel so aussehen könnte:</p>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    0    0    0    0
## [2,]    1    1    0    0    0
## [3,]    1    2    1    0    0
## [4,]    1    3    3    1    0
## [5,]    1    4    6    4    1</code></pre>
<p>Die erste Spalte der Matrix soll also die “obere linke Flanke” des Dreiecks repräsentieren.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="simulations-und-programmierübungen-in-r.html#cb242-1" aria-hidden="true" tabindex="-1"></a>binom_mat <span class="ot">&lt;-</span> <span class="cf">function</span>(z){                    <span class="co"># (1)</span></span>
<span id="cb242-2"><a href="simulations-und-programmierübungen-in-r.html#cb242-2" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,z,z)                       <span class="co"># (2)</span></span>
<span id="cb242-3"><a href="simulations-und-programmierübungen-in-r.html#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(z)){                          <span class="co"># (3)</span></span>
<span id="cb242-4"><a href="simulations-und-programmierübungen-in-r.html#cb242-4" aria-hidden="true" tabindex="-1"></a>    mat[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb242-5"><a href="simulations-und-programmierübungen-in-r.html#cb242-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb242-6"><a href="simulations-und-programmierübungen-in-r.html#cb242-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">2</span>,z)){                        <span class="co"># (4)</span></span>
<span id="cb242-7"><a href="simulations-und-programmierübungen-in-r.html#cb242-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">2</span>,i)){                      <span class="co"># (5)</span></span>
<span id="cb242-8"><a href="simulations-und-programmierübungen-in-r.html#cb242-8" aria-hidden="true" tabindex="-1"></a>      mat[i,j] <span class="ot">&lt;-</span> mat[i<span class="dv">-1</span>,j<span class="dv">-1</span>] <span class="sc">+</span> mat[i<span class="dv">-1</span>,j]  <span class="co"># (6)</span></span>
<span id="cb242-9"><a href="simulations-und-programmierübungen-in-r.html#cb242-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb242-10"><a href="simulations-und-programmierübungen-in-r.html#cb242-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb242-11"><a href="simulations-und-programmierübungen-in-r.html#cb242-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mat)                                <span class="co"># (7)</span></span>
<span id="cb242-12"><a href="simulations-und-programmierübungen-in-r.html#cb242-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Erläuterungen:</p>
<ol style="list-style-type: decimal">
<li><p>Die Matrix soll am Ende z Zeilen haben. Allerdings werden die Zeilen und Spalten einer Matrix beginnend mit 1 durchnummeriert, so dass die Zeilennummer nicht das n der Binomialkoeffizienten ist. Vielmehr stehen die Bionomialkoeffizienten <span class="math inline">\(n \choose k\)</span> am Ende in der Zeile mit der Nummer n+1 und der Spalte mit der Nummer k+1.</p></li>
<li><p>Hier wird eine Matrix erzeugt, die den Namen mat bekommt. Die Matrix wird zunächst mit Nullen gefüllt. Sie soll z Zeilen und z Spalten haben.</p></li>
<li><p>Die linke Spalte der Matrix wird mit Einsen gefüllt. Hier ist zu bemerken, dass die Elemente einer Matrix mit Zeilen- und Spaltennummer in eckigen Klammern angesprochen werden.</p></li>
<li><p>Hier folgen verschachtelte Schleifen. In der äußeren Schleife werden die Zeilen der Matrix angesprochen, die der Reihe nach mit den richtigen Zahlen gefüllt werden sollen. Die erste Zeile der Matrix hat schon die Endgestalt, daher beginnt die Schleife mit i=2.</p></li>
<li><p>Hier kommt die innere Schleife; die Zeile mit der Nummer i ist erreicht, die vorherigen Zeilen sind schon richtig aufgefüllt worden. Die Elemente in dieser Zeile ergeben sich dadurch, dass man die Zahlen links darüber und direkt darüber addiert. Die erste Zahl 1 der Zeile wurde vorher schon eingefüllt, daher fängt die Schleife mit j=2 an; außerdem sind die Zahlen am Ende alle 0 (sofern sie außerhalb des Dreiecks liegen), daher geht die Schleife nur bis j=i (i ist an dieser Stelle eine feste Zahl).</p></li>
<li><p>Hier werden – wie gerade beschrieben – die Zahlen der i-ten Zeile eingefügt.</p></li>
<li><p>Die Matrix ist jetzt fertig ausgefüllt und wird an dieser Stelle zurückgegeben.</p></li>
</ol>
</details>
<p>Für manche Anwendungen wollen wir vielleicht eine Liste, keine Matrix als Output haben.</p>
<p>Schreibe deswegen eine Funktion <code>binom_list</code>, die eine Liste von Vektoren zurückgibt.</p>
<p>Verpacke dann beide Funktionen in eine <code>binom_pascal</code>-Funktion, in der mit einem optionalen Argument das Output-Format für das Pascalsche Dreieck angibt.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="simulations-und-programmierübungen-in-r.html#cb243-1" aria-hidden="true" tabindex="-1"></a>binom_list <span class="ot">&lt;-</span> <span class="cf">function</span>(z) {</span>
<span id="cb243-2"><a href="simulations-und-programmierübungen-in-r.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb243-3"><a href="simulations-und-programmierübungen-in-r.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(z)) {</span>
<span id="cb243-4"><a href="simulations-und-programmierübungen-in-r.html#cb243-4" aria-hidden="true" tabindex="-1"></a>    out[[i]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb243-5"><a href="simulations-und-programmierübungen-in-r.html#cb243-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">1</span>) {</span>
<span id="cb243-6"><a href="simulations-und-programmierübungen-in-r.html#cb243-6" aria-hidden="true" tabindex="-1"></a>      out[[i]][j] <span class="ot">&lt;-</span></span>
<span id="cb243-7"><a href="simulations-und-programmierübungen-in-r.html#cb243-7" aria-hidden="true" tabindex="-1"></a>        out[[i <span class="sc">-</span> <span class="dv">1</span>]][j <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(out[[i <span class="sc">-</span> <span class="dv">1</span>]][j]), </span>
<span id="cb243-8"><a href="simulations-und-programmierübungen-in-r.html#cb243-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="dv">0</span>, </span>
<span id="cb243-9"><a href="simulations-und-programmierübungen-in-r.html#cb243-9" aria-hidden="true" tabindex="-1"></a>                                     out[[i <span class="sc">-</span> <span class="dv">1</span>]][j])</span>
<span id="cb243-10"><a href="simulations-und-programmierübungen-in-r.html#cb243-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb243-11"><a href="simulations-und-programmierübungen-in-r.html#cb243-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb243-12"><a href="simulations-und-programmierübungen-in-r.html#cb243-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb243-13"><a href="simulations-und-programmierübungen-in-r.html#cb243-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb243-14"><a href="simulations-und-programmierübungen-in-r.html#cb243-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-15"><a href="simulations-und-programmierübungen-in-r.html#cb243-15" aria-hidden="true" tabindex="-1"></a><span class="fu">binom_list</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 1 1
## 
## [[3]]
## [1] 1 2 1
## 
## [[4]]
## [1] 1 3 3 1
## 
## [[5]]
## [1] 1 4 6 4 1</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="simulations-und-programmierübungen-in-r.html#cb245-1" aria-hidden="true" tabindex="-1"></a>binom_pascal <span class="ot">&lt;-</span> <span class="cf">function</span>(z, <span class="at">format =</span> <span class="st">&#39;m&#39;</span>){</span>
<span id="cb245-2"><a href="simulations-und-programmierübungen-in-r.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(format <span class="sc">!=</span> <span class="st">&#39;m&#39;</span>){</span>
<span id="cb245-3"><a href="simulations-und-programmierübungen-in-r.html#cb245-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">binom_list</span>(z))</span>
<span id="cb245-4"><a href="simulations-und-programmierübungen-in-r.html#cb245-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb245-5"><a href="simulations-und-programmierübungen-in-r.html#cb245-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">binom_mat</span>(z))</span>
<span id="cb245-6"><a href="simulations-und-programmierübungen-in-r.html#cb245-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Erweitere deine Listenfunktion so, dass die zurückgegebene Liste die Klasse <code>pascal</code> hat und die Anzahl der Zeilen des Dreiecks im <code>n</code>-Attribut abgelegt wird.</p>
<p>Schreibe nun eine Erweiterung des <code>print</code>-Befehls, indem du eine Funktion <code>print.pascal</code> definierst, die die Argumente <code>x</code> und den <code>...</code>-Operator erwartet.</p>
<p>Mit diesem Namen legst Du fest, dass die <code>pascal</code>-Klasse mit genau dieser Funktion geprintet werden soll, sobald also ein Objekt diese Klasse hat, wird diese Printfunktion aufgerufen.</p>
<p>Der Output soll dabei so aussehen:</p>
<pre><code>##     1
##    1 1
##   1 2 1
##  1 3 3 1
## 1 4 6 4 1</code></pre>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="simulations-und-programmierübungen-in-r.html#cb247-1" aria-hidden="true" tabindex="-1"></a>binom_list <span class="ot">&lt;-</span> <span class="cf">function</span>(z) {</span>
<span id="cb247-2"><a href="simulations-und-programmierübungen-in-r.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb247-3"><a href="simulations-und-programmierübungen-in-r.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(z)) {</span>
<span id="cb247-4"><a href="simulations-und-programmierübungen-in-r.html#cb247-4" aria-hidden="true" tabindex="-1"></a>    out[[i]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb247-5"><a href="simulations-und-programmierübungen-in-r.html#cb247-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">1</span>) {</span>
<span id="cb247-6"><a href="simulations-und-programmierübungen-in-r.html#cb247-6" aria-hidden="true" tabindex="-1"></a>      out[[i]][j] <span class="ot">&lt;-</span></span>
<span id="cb247-7"><a href="simulations-und-programmierübungen-in-r.html#cb247-7" aria-hidden="true" tabindex="-1"></a>        out[[i <span class="sc">-</span> <span class="dv">1</span>]][j <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(out[[i <span class="sc">-</span> <span class="dv">1</span>]][j]), </span>
<span id="cb247-8"><a href="simulations-und-programmierübungen-in-r.html#cb247-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="dv">0</span>, </span>
<span id="cb247-9"><a href="simulations-und-programmierübungen-in-r.html#cb247-9" aria-hidden="true" tabindex="-1"></a>                                     out[[i <span class="sc">-</span> <span class="dv">1</span>]][j])</span>
<span id="cb247-10"><a href="simulations-und-programmierübungen-in-r.html#cb247-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb247-11"><a href="simulations-und-programmierübungen-in-r.html#cb247-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb247-12"><a href="simulations-und-programmierübungen-in-r.html#cb247-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributes</span>(out)<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="st">&#39;pascal&#39;</span></span>
<span id="cb247-13"><a href="simulations-und-programmierübungen-in-r.html#cb247-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributes</span>(out)<span class="sc">$</span>n <span class="ot">&lt;-</span> z</span>
<span id="cb247-14"><a href="simulations-und-programmierübungen-in-r.html#cb247-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb247-15"><a href="simulations-und-programmierübungen-in-r.html#cb247-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb247-16"><a href="simulations-und-programmierübungen-in-r.html#cb247-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-17"><a href="simulations-und-programmierübungen-in-r.html#cb247-17" aria-hidden="true" tabindex="-1"></a><span class="do">## für einfache Zahlen können wir die print-Funktion so schreiben:</span></span>
<span id="cb247-18"><a href="simulations-und-programmierübungen-in-r.html#cb247-18" aria-hidden="true" tabindex="-1"></a>print.pascal <span class="ot">&lt;-</span> <span class="cf">function</span>(x,...){</span>
<span id="cb247-19"><a href="simulations-und-programmierübungen-in-r.html#cb247-19" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">attributes</span>(x)[[<span class="st">&#39;n&#39;</span>]]</span>
<span id="cb247-20"><a href="simulations-und-programmierübungen-in-r.html#cb247-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(n)){</span>
<span id="cb247-21"><a href="simulations-und-programmierübungen-in-r.html#cb247-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">rep</span>(<span class="st">&#39; &#39;</span>, n<span class="sc">-</span>i), <span class="at">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb247-22"><a href="simulations-und-programmierübungen-in-r.html#cb247-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(x[[i]])</span>
<span id="cb247-23"><a href="simulations-und-programmierübungen-in-r.html#cb247-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb247-24"><a href="simulations-und-programmierübungen-in-r.html#cb247-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb247-25"><a href="simulations-und-programmierübungen-in-r.html#cb247-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb247-26"><a href="simulations-und-programmierübungen-in-r.html#cb247-26" aria-hidden="true" tabindex="-1"></a><span class="do">## funktioniert:</span></span>
<span id="cb247-27"><a href="simulations-und-programmierübungen-in-r.html#cb247-27" aria-hidden="true" tabindex="-1"></a><span class="fu">binom_list</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##     1
##    1 1
##   1 2 1
##  1 3 3 1
## 1 4 6 4 1</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="simulations-und-programmierübungen-in-r.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="do">## geht bei mehr digits aber kaputt:</span></span>
<span id="cb249-2"><a href="simulations-und-programmierübungen-in-r.html#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="fu">binom_list</span>(<span class="dv">7</span>)</span></code></pre></div>
<pre><code>##       1
##      1 1
##     1 2 1
##    1 3 3 1
##   1 4 6 4 1
##  1 5 10 10 5 1
## 1 6 15 20 15 6 1</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="simulations-und-programmierübungen-in-r.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="do">## mit einer Verallgemeinerung der eingefügten Leerzeichen klappt das aber auch:</span></span>
<span id="cb251-2"><a href="simulations-und-programmierübungen-in-r.html#cb251-2" aria-hidden="true" tabindex="-1"></a>print.pascal <span class="ot">&lt;-</span> <span class="cf">function</span>(x,...){</span>
<span id="cb251-3"><a href="simulations-und-programmierübungen-in-r.html#cb251-3" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">attr</span>(x, <span class="st">&#39;n&#39;</span>)</span>
<span id="cb251-4"><a href="simulations-und-programmierübungen-in-r.html#cb251-4" aria-hidden="true" tabindex="-1"></a>  nsp <span class="ot">&lt;-</span> <span class="fu">nchar</span>(<span class="fu">as.character</span>(<span class="fu">max</span>(x[[n]]))) <span class="co"># guck wie viele Stellen die längste Zahl hat</span></span>
<span id="cb251-5"><a href="simulations-und-programmierübungen-in-r.html#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(n)){</span>
<span id="cb251-6"><a href="simulations-und-programmierübungen-in-r.html#cb251-6" aria-hidden="true" tabindex="-1"></a>    dummy <span class="ot">&lt;-</span> <span class="fu">str_pad</span>(<span class="fu">as.character</span>(x[[i]]), <span class="co"># ergänze die Zahl als character auf die größte Länge</span></span>
<span id="cb251-7"><a href="simulations-und-programmierübungen-in-r.html#cb251-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">side =</span> <span class="st">&#39;left&#39;</span>, </span>
<span id="cb251-8"><a href="simulations-und-programmierübungen-in-r.html#cb251-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">width =</span> nsp)</span>
<span id="cb251-9"><a href="simulations-und-programmierübungen-in-r.html#cb251-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">rep</span>(<span class="st">&#39; &#39;</span>, nsp <span class="sc">*</span> (n<span class="sc">-</span>i)), <span class="at">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb251-10"><a href="simulations-und-programmierübungen-in-r.html#cb251-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(dummy, <span class="at">sep =</span> <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="st">&#39; &#39;</span>, nsp), <span class="at">collapse =</span> <span class="st">&#39;&#39;</span>))</span>
<span id="cb251-11"><a href="simulations-und-programmierübungen-in-r.html#cb251-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb251-12"><a href="simulations-und-programmierübungen-in-r.html#cb251-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb251-13"><a href="simulations-und-programmierübungen-in-r.html#cb251-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb251-14"><a href="simulations-und-programmierübungen-in-r.html#cb251-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-15"><a href="simulations-und-programmierübungen-in-r.html#cb251-15" aria-hidden="true" tabindex="-1"></a><span class="fu">binom_list</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##                              1
##                           1     1
##                        1     2     1
##                     1     3     3     1
##                  1     4     6     4     1
##               1     5    10    10     5     1
##            1     6    15    20    15     6     1
##         1     7    21    35    35    21     7     1
##      1     8    28    56    70    56    28     8     1
##   1     9    36    84   126   126    84    36     9     1</code></pre>
</details>
<p>Als letztes wollen wir die Funktion nur noch praktisch nutzen.
Dafür müssen wir noch eine Funktion <code>binom_coeff</code> schreiben, die für gegebenes n und k den Wert des Binominialkoeffizienten ausgibt.</p>
<p>Überlege Dir dazu, ob Du lieber <code>binom_mat</code> oder <code>binom_list</code> benutzen möchtest.
Mit <code>choose(n,k)</code> kannst Du überprüfen, ob die in R angelegte Funktion für den Binomialkoeffizienten auf dieselbe Lösung kommt.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="simulations-und-programmierübungen-in-r.html#cb253-1" aria-hidden="true" tabindex="-1"></a>binom_coeff <span class="ot">&lt;-</span> <span class="cf">function</span>(n,k){</span>
<span id="cb253-2"><a href="simulations-und-programmierübungen-in-r.html#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(n<span class="sc">==</span><span class="dv">0</span>){                               <span class="co"># (1)</span></span>
<span id="cb253-3"><a href="simulations-und-programmierübungen-in-r.html#cb253-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(k<span class="sc">==</span><span class="dv">0</span>){<span class="fu">return</span>(<span class="dv">1</span>)} <span class="cf">else</span>{<span class="fu">return</span>(<span class="dv">0</span>)}</span>
<span id="cb253-4"><a href="simulations-und-programmierübungen-in-r.html#cb253-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb253-5"><a href="simulations-und-programmierübungen-in-r.html#cb253-5" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">binom_pascal</span>(n<span class="sc">+</span><span class="dv">1</span>)                <span class="co"># (2)</span></span>
<span id="cb253-6"><a href="simulations-und-programmierübungen-in-r.html#cb253-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mat[n<span class="sc">+</span><span class="dv">1</span>,k<span class="sc">+</span><span class="dv">1</span>])                    <span class="co"># (3)</span></span>
<span id="cb253-7"><a href="simulations-und-programmierübungen-in-r.html#cb253-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb253-8"><a href="simulations-und-programmierübungen-in-r.html#cb253-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-9"><a href="simulations-und-programmierübungen-in-r.html#cb253-9" aria-hidden="true" tabindex="-1"></a><span class="fu">binom_coeff</span>(<span class="dv">10</span>,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 45</code></pre>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="simulations-und-programmierübungen-in-r.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">choose</span>(<span class="dv">10</span>,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 45</code></pre>
<p>Anmerkungen:</p>
<ol style="list-style-type: decimal">
<li><p>n = 0 muss abgefangen werden.</p></li>
<li><p>Wenn n nicht 0 ist, wird die Matrix erzeugt, die ausreichend groß ist, also n+1 Zeilen hat.</p></li>
<li><p>Der gesuchte Koeffizient steht dann in der Zeile n+1 und der Spalte k+1, da ja die Nummerierung der Zeilen und Spalten einer Matrix mit 1 beginnt und nicht mit 0.</p></li>
</ol>
<p>Aus Spaß können wir auch mal die beiden Implementationen vergleichen.
Dazu bauen wir eine fast identische Funktion, die mit den Listen arbeitet und geben beide in <code>bench::mark</code>:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="simulations-und-programmierübungen-in-r.html#cb257-1" aria-hidden="true" tabindex="-1"></a>binom_coeff_l <span class="ot">&lt;-</span> <span class="cf">function</span>(n,k){</span>
<span id="cb257-2"><a href="simulations-und-programmierübungen-in-r.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(n<span class="sc">==</span><span class="dv">0</span>){ </span>
<span id="cb257-3"><a href="simulations-und-programmierübungen-in-r.html#cb257-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(k<span class="sc">==</span><span class="dv">0</span>){<span class="fu">return</span>(<span class="dv">1</span>)} <span class="cf">else</span>{<span class="fu">return</span>(<span class="dv">0</span>)}</span>
<span id="cb257-4"><a href="simulations-und-programmierübungen-in-r.html#cb257-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb257-5"><a href="simulations-und-programmierübungen-in-r.html#cb257-5" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">binom_pascal</span>(n<span class="sc">+</span><span class="dv">1</span>, <span class="st">&#39;l&#39;</span>)</span>
<span id="cb257-6"><a href="simulations-und-programmierübungen-in-r.html#cb257-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mat[[n<span class="sc">+</span><span class="dv">1</span>]][k<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb257-7"><a href="simulations-und-programmierübungen-in-r.html#cb257-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb257-8"><a href="simulations-und-programmierübungen-in-r.html#cb257-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-9"><a href="simulations-und-programmierübungen-in-r.html#cb257-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bench)</span>
<span id="cb257-10"><a href="simulations-und-programmierübungen-in-r.html#cb257-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-11"><a href="simulations-und-programmierübungen-in-r.html#cb257-11" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb257-12"><a href="simulations-und-programmierübungen-in-r.html#cb257-12" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb257-13"><a href="simulations-und-programmierübungen-in-r.html#cb257-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-14"><a href="simulations-und-programmierübungen-in-r.html#cb257-14" aria-hidden="true" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(<span class="at">iterations =</span> <span class="dv">100</span>,</span>
<span id="cb257-15"><a href="simulations-und-programmierübungen-in-r.html#cb257-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">list =</span> <span class="fu">binom_coeff_l</span>(n,k),</span>
<span id="cb257-16"><a href="simulations-und-programmierübungen-in-r.html#cb257-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">mat =</span> <span class="fu">binom_coeff</span>(n,k)) <span class="sc">%&gt;%</span> </span>
<span id="cb257-17"><a href="simulations-und-programmierübungen-in-r.html#cb257-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">&#39;violin&#39;</span>)</span></code></pre></div>
<p><img src="Robustheit_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
<p>Die Matritzen-Variante ist wesentlich schneller, probieren wir noch einmal wie sich das für verschieden große Matritzen verhält:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="simulations-und-programmierübungen-in-r.html#cb258-1" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> bench<span class="sc">::</span><span class="fu">press</span>(</span>
<span id="cb258-2"><a href="simulations-und-programmierübungen-in-r.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb258-3"><a href="simulations-und-programmierübungen-in-r.html#cb258-3" aria-hidden="true" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(<span class="at">iterations =</span> <span class="dv">100</span>,</span>
<span id="cb258-4"><a href="simulations-und-programmierübungen-in-r.html#cb258-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">list =</span> <span class="fu">binom_coeff_l</span>(n,k),</span>
<span id="cb258-5"><a href="simulations-und-programmierübungen-in-r.html#cb258-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mat =</span> <span class="fu">binom_coeff</span>(n,k)) </span>
<span id="cb258-6"><a href="simulations-und-programmierübungen-in-r.html#cb258-6" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb258-7"><a href="simulations-und-programmierübungen-in-r.html#cb258-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-8"><a href="simulations-und-programmierübungen-in-r.html#cb258-8" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap_dfr</span>(<span class="fu">list</span>(sim<span class="sc">$</span>time,</span>
<span id="cb258-9"><a href="simulations-und-programmierübungen-in-r.html#cb258-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">names</span>(sim<span class="sc">$</span>expression),</span>
<span id="cb258-10"><a href="simulations-und-programmierübungen-in-r.html#cb258-10" aria-hidden="true" tabindex="-1"></a>              sim<span class="sc">$</span>n),</span>
<span id="cb258-11"><a href="simulations-und-programmierübungen-in-r.html#cb258-11" aria-hidden="true" tabindex="-1"></a>         <span class="sc">~</span><span class="fu">tibble</span>(<span class="at">times =</span> <span class="fu">as.numeric</span>(..<span class="dv">1</span>),</span>
<span id="cb258-12"><a href="simulations-und-programmierübungen-in-r.html#cb258-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">iterator =</span> ..<span class="dv">2</span>,</span>
<span id="cb258-13"><a href="simulations-und-programmierübungen-in-r.html#cb258-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">reps =</span> <span class="dv">100</span> <span class="sc">*</span> ..<span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb258-14"><a href="simulations-und-programmierübungen-in-r.html#cb258-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> reps,</span>
<span id="cb258-15"><a href="simulations-und-programmierübungen-in-r.html#cb258-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> times,</span>
<span id="cb258-16"><a href="simulations-und-programmierübungen-in-r.html#cb258-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> iterator)) <span class="sc">+</span></span>
<span id="cb258-17"><a href="simulations-und-programmierübungen-in-r.html#cb258-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb258-18"><a href="simulations-und-programmierübungen-in-r.html#cb258-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">geom=</span><span class="st">&#39;line&#39;</span>,</span>
<span id="cb258-19"><a href="simulations-und-programmierübungen-in-r.html#cb258-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">fun =</span> median) <span class="sc">+</span></span>
<span id="cb258-20"><a href="simulations-und-programmierübungen-in-r.html#cb258-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;Zeit [s]&#39;</span>,</span>
<span id="cb258-21"><a href="simulations-und-programmierübungen-in-r.html#cb258-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&#39;Iterierte Werte&#39;</span>) <span class="sc">+</span></span>
<span id="cb258-22"><a href="simulations-und-programmierübungen-in-r.html#cb258-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&#39;Dark2&#39;</span>) <span class="sc">+</span></span>
<span id="cb258-23"><a href="simulations-und-programmierübungen-in-r.html#cb258-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>,</span>
<span id="cb258-24"><a href="simulations-und-programmierübungen-in-r.html#cb258-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb258-25"><a href="simulations-und-programmierübungen-in-r.html#cb258-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb258-26"><a href="simulations-und-programmierübungen-in-r.html#cb258-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-27"><a href="simulations-und-programmierübungen-in-r.html#cb258-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;imgs/list_mat_pascal.png&#39;</span>,</span>
<span id="cb258-28"><a href="simulations-und-programmierübungen-in-r.html#cb258-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">scale =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="imgs/list_mat_pascal.png" width="2450" /></p>
</details>
</div>
<div id="matrizen-und-chi2" class="section level2">
<h2>Matrizen und <span class="math inline">\(\chi^2\)</span></h2>
<p>Beispiele für Matrizen sind Kontingenztafeln. Hier spielen die Randsummen eine wichtige Rolle, die <code>apply</code>-Funktion bietet die oben schon erwähnte Möglichkeit, solche Randsummen besonders einfach zu bilden:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="simulations-und-programmierübungen-in-r.html#cb259-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb259-2"><a href="simulations-und-programmierübungen-in-r.html#cb259-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="simulations-und-programmierübungen-in-r.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> sum)</span></code></pre></div>
<pre><code>## [1] 4 6</code></pre>
<p>Die Argumente FUN und MARGIN müssen hier angegeben werden. Im Beispiel sollen Summen gebildet werden (FUN = sum), wobei ein Index festgehalten wird, hier Zeilenindex (MARGIN = 1). Der andere Index (hier dann der Spaltenindex) ist der Index, über den summiert wird. Sind die Einträge der Matix <span class="math inline">\(x_{ij}\)</span>, so werden also die Summen <span class="math inline">\(\sum_j x_{ij}\)</span> gebildet, die Randsummen am rechten Rand.</p>
<p>Dasselbe mit MARGIN = 2 liefert die Summen der Einträge in den jeweiligen Spalten, also die Randsummen am unteren Rand, ausprobieren!</p>
<p>An der Stelle von sum können auch andere Funktionen eingesetzt werden, beispielsweise prod, wenn nicht Summen, sondern Produkte gebildet werden sollen (ausprobieren!).</p>
<p>Alternativ sind in R mit <code>colSums</code> und <code>rowSums</code> Funktionen zur Bildung von Spalten- und Zeilensummen schon implementiert, außerdem könnten wir auch eine <code>for</code>-Schleife nutzen, um die Summen zu berechnen.</p>
<p>Überlege zuerst, wie man Eine Funktion schreiben könnte, die mit denselben Argumenten wie <code>apply</code> mit Hilfe einer <code>for</code>-Schleife Zeilen- oder Spaltenweise Werte aggregiert.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="simulations-und-programmierübungen-in-r.html#cb263-1" aria-hidden="true" tabindex="-1"></a>my_apply <span class="ot">&lt;-</span> <span class="cf">function</span>(m,MARGIN,FUN, ...){</span>
<span id="cb263-2"><a href="simulations-und-programmierübungen-in-r.html#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(MARGIN <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb263-3"><a href="simulations-und-programmierübungen-in-r.html#cb263-3" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">t</span>(m)</span>
<span id="cb263-4"><a href="simulations-und-programmierübungen-in-r.html#cb263-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb263-5"><a href="simulations-und-programmierübungen-in-r.html#cb263-5" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">nrow</span>(m))</span>
<span id="cb263-6"><a href="simulations-und-programmierübungen-in-r.html#cb263-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(m))) {</span>
<span id="cb263-7"><a href="simulations-und-programmierübungen-in-r.html#cb263-7" aria-hidden="true" tabindex="-1"></a>    out[i] <span class="ot">&lt;-</span> <span class="fu">FUN</span>(m[i,], ...)</span>
<span id="cb263-8"><a href="simulations-und-programmierübungen-in-r.html#cb263-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb263-9"><a href="simulations-und-programmierübungen-in-r.html#cb263-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb263-10"><a href="simulations-und-programmierübungen-in-r.html#cb263-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb263-11"><a href="simulations-und-programmierübungen-in-r.html#cb263-11" aria-hidden="true" tabindex="-1"></a><span class="fu">my_apply</span>(m, <span class="dv">2</span>, sum)</span></code></pre></div>
<pre><code>## [1] 3 7</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="simulations-und-programmierübungen-in-r.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m, <span class="dv">2</span>, sum)</span></code></pre></div>
<pre><code>## [1] 3 7</code></pre>
</details>
<p>Nutze jetzt deine <code>for</code>-<code>apply</code>-Alternative, <code>apply</code> und <code>rowSums</code> um mit bench::mark zu testen, welche dieser Funktionen am besten in 100 Tests auf Basis einer 100x100-Matrix performed.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="simulations-und-programmierübungen-in-r.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bench)</span>
<span id="cb267-2"><a href="simulations-und-programmierübungen-in-r.html#cb267-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="at">ncol =</span> <span class="dv">100</span>)</span>
<span id="cb267-3"><a href="simulations-und-programmierübungen-in-r.html#cb267-3" aria-hidden="true" tabindex="-1"></a>bmark <span class="ot">&lt;-</span> <span class="fu">mark</span>(</span>
<span id="cb267-4"><a href="simulations-und-programmierübungen-in-r.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iterations =</span> <span class="dv">100</span>,</span>
<span id="cb267-5"><a href="simulations-und-programmierübungen-in-r.html#cb267-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">for_apply =</span> <span class="fu">my_apply</span>(m, <span class="dv">1</span>, sum),</span>
<span id="cb267-6"><a href="simulations-und-programmierübungen-in-r.html#cb267-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">apply =</span> <span class="fu">apply</span>(m, <span class="dv">1</span>, sum),</span>
<span id="cb267-7"><a href="simulations-und-programmierübungen-in-r.html#cb267-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowSums =</span> <span class="fu">rowSums</span>(m)</span>
<span id="cb267-8"><a href="simulations-und-programmierübungen-in-r.html#cb267-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb267-9"><a href="simulations-und-programmierübungen-in-r.html#cb267-9" aria-hidden="true" tabindex="-1"></a>bmark <span class="sc">%&gt;%</span> </span>
<span id="cb267-10"><a href="simulations-und-programmierübungen-in-r.html#cb267-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">&#39;violin&#39;</span>)</span></code></pre></div>
<p><img src="Robustheit_files/figure-html/unnamed-chunk-106-1.png" width="672" /></p>
</details>
<p>Eine dieser Funktionen können wir nun benutzen, um den chi-Quadrat-Wert einer Kontingenztafel zu bestimmen.</p>
<p>Schreibe dazu eine Funktion, die für eine Matrix <code>x</code> einen chi-Quadrat-Wert nach der Formel <span class="math display">\[\chi^2=\sum_{i,j}\frac{(f_{o,ij}-f_{e,ij})^2}{f_{e,ij}} = \sum_{i,j}\frac{\left(n_{ij}- \frac{n_{i\cdot} n_{\cdot j}}{n}\right)^2}{\frac{n_{i\cdot} n_{\cdot j}}{n}}\]</span> berechnet.
Für diese Funktion gibt es zwei Möglichkeiten zur Implementation. Zum Einen können geschachtelte <code>for</code>-Schleifen verwendet werden, zur anderen kann die <code>sweep</code>-Funktion benutzt werden.
<code>sweep()</code> kann benutzt werden um eine Matrix zeilen-oder spaltenweise mit einem Vektor zu transformieren. Dabei kann ein arithmetsicher Operator (+,-,…) genutzt werden um die Werte zu verrechnen. Hier ist ein einfaches Beispiel in dem mit <code>sweep</code> das kleine 1-mal-1 in einer 10x10-Matrix erstellt wird:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="simulations-und-programmierübungen-in-r.html#cb268-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">each =</span> <span class="dv">10</span>), <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb268-2"><a href="simulations-und-programmierübungen-in-r.html#cb268-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    1    2    3    4    5    6    7    8    9    10
##  [2,]    1    2    3    4    5    6    7    8    9    10
##  [3,]    1    2    3    4    5    6    7    8    9    10
##  [4,]    1    2    3    4    5    6    7    8    9    10
##  [5,]    1    2    3    4    5    6    7    8    9    10
##  [6,]    1    2    3    4    5    6    7    8    9    10
##  [7,]    1    2    3    4    5    6    7    8    9    10
##  [8,]    1    2    3    4    5    6    7    8    9    10
##  [9,]    1    2    3    4    5    6    7    8    9    10
## [10,]    1    2    3    4    5    6    7    8    9    10</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="simulations-und-programmierübungen-in-r.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sweep</span>(m, <span class="co"># Matrix</span></span>
<span id="cb270-2"><a href="simulations-und-programmierübungen-in-r.html#cb270-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="co"># zeilenweise, also pro Zeile ein anderer Wert des Vektors</span></span>
<span id="cb270-3"><a href="simulations-und-programmierübungen-in-r.html#cb270-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">STATS =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="co"># der Vektor mit dem multipliziert werden soll</span></span>
<span id="cb270-4"><a href="simulations-und-programmierübungen-in-r.html#cb270-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> <span class="st">&#39;*&#39;</span>) <span class="co"># Angabe dass multipliziert werden soll</span></span></code></pre></div>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    1    2    3    4    5    6    7    8    9    10
##  [2,]    2    4    6    8   10   12   14   16   18    20
##  [3,]    3    6    9   12   15   18   21   24   27    30
##  [4,]    4    8   12   16   20   24   28   32   36    40
##  [5,]    5   10   15   20   25   30   35   40   45    50
##  [6,]    6   12   18   24   30   36   42   48   54    60
##  [7,]    7   14   21   28   35   42   49   56   63    70
##  [8,]    8   16   24   32   40   48   56   64   72    80
##  [9,]    9   18   27   36   45   54   63   72   81    90
## [10,]   10   20   30   40   50   60   70   80   90   100</code></pre>
<p>Suche Dir einen der beiden Wege aus und setze diesen um.
Mit der <code>chisq.test</code>-Funktion könnt Ihr überprüfen, ob die bestehende Implementation auf dieselbe Lösung kommt.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="simulations-und-programmierübungen-in-r.html#cb272-1" aria-hidden="true" tabindex="-1"></a>for_chisq <span class="ot">&lt;-</span> <span class="cf">function</span>(m){                   <span class="co"># (1)</span></span>
<span id="cb272-2"><a href="simulations-und-programmierübungen-in-r.html#cb272-2" aria-hidden="true" tabindex="-1"></a>  I <span class="ot">&lt;-</span> <span class="fu">dim</span>(m)[<span class="dv">1</span>]                            <span class="co"># (2)</span></span>
<span id="cb272-3"><a href="simulations-und-programmierübungen-in-r.html#cb272-3" aria-hidden="true" tabindex="-1"></a>  J <span class="ot">&lt;-</span> <span class="fu">dim</span>(m)[<span class="dv">2</span>]</span>
<span id="cb272-4"><a href="simulations-und-programmierübungen-in-r.html#cb272-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">sum</span>(m)                               <span class="co"># (3)</span></span>
<span id="cb272-5"><a href="simulations-und-programmierübungen-in-r.html#cb272-5" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,I<span class="sc">*</span>J),<span class="at">nrow =</span> I)          <span class="co"># (4)</span></span>
<span id="cb272-6"><a href="simulations-und-programmierübungen-in-r.html#cb272-6" aria-hidden="true" tabindex="-1"></a>  nip <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(m)                         <span class="co"># (5)</span></span>
<span id="cb272-7"><a href="simulations-und-programmierübungen-in-r.html#cb272-7" aria-hidden="true" tabindex="-1"></a>  npj <span class="ot">&lt;-</span> <span class="fu">colSums</span>(m)</span>
<span id="cb272-8"><a href="simulations-und-programmierübungen-in-r.html#cb272-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(I)){                         <span class="co"># (6)</span></span>
<span id="cb272-9"><a href="simulations-und-programmierübungen-in-r.html#cb272-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">seq</span>(J)){</span>
<span id="cb272-10"><a href="simulations-und-programmierübungen-in-r.html#cb272-10" aria-hidden="true" tabindex="-1"></a>      e[i,j] <span class="ot">&lt;-</span> nip[i] <span class="sc">*</span> npj[j]<span class="sc">/</span>n</span>
<span id="cb272-11"><a href="simulations-und-programmierübungen-in-r.html#cb272-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb272-12"><a href="simulations-und-programmierübungen-in-r.html#cb272-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb272-13"><a href="simulations-und-programmierübungen-in-r.html#cb272-13" aria-hidden="true" tabindex="-1"></a>  e1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,I<span class="sc">*</span>J),<span class="at">nrow =</span> I)         <span class="co"># (7)</span></span>
<span id="cb272-14"><a href="simulations-und-programmierübungen-in-r.html#cb272-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(I)){</span>
<span id="cb272-15"><a href="simulations-und-programmierübungen-in-r.html#cb272-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">seq</span>(J)){</span>
<span id="cb272-16"><a href="simulations-und-programmierübungen-in-r.html#cb272-16" aria-hidden="true" tabindex="-1"></a>      e1[i,j] <span class="ot">&lt;-</span> (m[i,j]<span class="sc">-</span>e[i,j])<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>e[i,j]   <span class="co"># (8)</span></span>
<span id="cb272-17"><a href="simulations-und-programmierübungen-in-r.html#cb272-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb272-18"><a href="simulations-und-programmierübungen-in-r.html#cb272-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb272-19"><a href="simulations-und-programmierübungen-in-r.html#cb272-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sum</span>(e1))                           <span class="co"># (9)</span></span>
<span id="cb272-20"><a href="simulations-und-programmierübungen-in-r.html#cb272-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Anmerkungen:</p>
<ol style="list-style-type: decimal">
<li><p>Die Matrix x ist die zu untersuchende Kontingenztafel mit absoluten Häufigkeiten. Zur Berechnung wird die Formel Folie 165 QM1 benutzt.</p></li>
<li><p>Die Zeilenzahl I der Matrix wird bestimmt (zur Erinnerung: R unterscheidet zwischen Groß- und Kleinbuchstaben), nächste Zeile: Spaltenzahl J.</p></li>
<li><p>Die Gesamtzahl n aller Beobachtungen.</p></li>
<li><p>In der Matrix e sollen nachher die erwarteten Häufigkeiten stehen, hier wird die Matrix angelegt und mit Nullen gefüllt.</p></li>
<li><p>Vektor der rechten Randsummen (<span class="math inline">\(n_{i.}\)</span>), nächste Zeile untere Randsummen (<span class="math inline">\(n_{.j}\)</span>).</p></li>
<li><p>Die Matrix e wird mit den erwarteten Häufigkeiten gefüllt.</p></li>
<li><p>In der Matrix e1 sollen nachher die Summanden für den chi-Quadrat-Koeffizienten stehen, hier wird sie mit Nullen gefüllt angelegt.</p></li>
<li><p>Die Matrix e1 wird mit den Summanden gefüllt.</p></li>
<li><p>Der chi-Quadrat-Koeffizient ist jetzt die Summe der Zahlen in der Matrix e1.</p></li>
</ol>
<div class="sourceCode" id="cb273"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb273-1"><a href="simulations-und-programmierübungen-in-r.html#cb273-1"></a>mat_chisq <span class="ot">&lt;-</span> <span class="cf">function</span>(m) {</span>
<span id="cb273-2"><a href="simulations-und-programmierübungen-in-r.html#cb273-2"></a>  e <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fu">colSums</span>(m),   </span>
<span id="cb273-3"><a href="simulations-und-programmierübungen-in-r.html#cb273-3"></a>                  <span class="at">each =</span> <span class="fu">nrow</span>(m)),</span>
<span id="cb273-4"><a href="simulations-und-programmierübungen-in-r.html#cb273-4"></a>              <span class="at">nrow =</span> <span class="fu">nrow</span>(m))</span>
<span id="cb273-5"><a href="simulations-und-programmierübungen-in-r.html#cb273-5"></a>  </span>
<span id="cb273-6"><a href="simulations-und-programmierübungen-in-r.html#cb273-6"></a>  e <span class="ot">&lt;-</span> <span class="fu">sweep</span>(e, </span>
<span id="cb273-7"><a href="simulations-und-programmierübungen-in-r.html#cb273-7"></a>             <span class="fu">rowSums</span>(m), </span>
<span id="cb273-8"><a href="simulations-und-programmierübungen-in-r.html#cb273-8"></a>             <span class="at">MARGIN =</span> <span class="dv">1</span>, </span>
<span id="cb273-9"><a href="simulations-und-programmierübungen-in-r.html#cb273-9"></a>             <span class="at">FUN =</span> <span class="st">&#39;*&#39;</span>) </span>
<span id="cb273-10"><a href="simulations-und-programmierübungen-in-r.html#cb273-10"></a>  e <span class="ot">&lt;-</span> e <span class="sc">/</span> <span class="fu">sum</span>(m)</span>
<span id="cb273-11"><a href="simulations-und-programmierübungen-in-r.html#cb273-11"></a>  <span class="fu">return</span>(<span class="fu">sum</span>((m <span class="sc">-</span> e) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">/</span> e))</span>
<span id="cb273-12"><a href="simulations-und-programmierübungen-in-r.html#cb273-12"></a>}</span></code></pre></div>
<table class=" lightable-classic lightable-classic-2" style="font-size: 15px; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
Zeile
</th>
<th style="text-align:left;">
Was passiert?
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Matrix wird aufgefüllt mit Spaltensummen (wir erinnern uns dass Matrizen in R spaltenweise aufgefüllt werden)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
und zwar wird jede Spaltensumme pro Spalte in jede Zeile geschrieben
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
und die Matrix soll dieselben Maße wie m haben.
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Wir nehmen die Matrix der Spaltensummen
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
und die Zeilensummen
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
gehen zeilenweise vor (jede Zeile eine Zeilensumme)
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
und multiplizieren die ni. und n.j in jeder Zelle.
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Dann müssen wir die Zellen nur noch durch die Gesamtzahl der Beobachtungen teilen und haben die eij.
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Als letztes quadrieren wir die Abweichungen der Matirx von den eij, teilen die Ergebnisse durch die eij und summieren alles auf.
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
</details>
<p>Kleine Zusatzaufgabe falls Interesse besteht:
Benchmarke die zwei Implementationen (gerne die aus der Musterlösung, Du musst nicht noch selber die andere umsetzen<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>) und die folgende Variante gegeneinander:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="simulations-und-programmierübungen-in-r.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unname</span>(<span class="fu">chisq.test</span>(m)<span class="sc">$</span>statistic)</span></code></pre></div>
<p>Was kommt raus?
Hast Du eine Idee, warum das Ergebnis so aussieht wie es aussieht?</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="simulations-und-programmierübungen-in-r.html#cb275-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="at">ncol =</span> <span class="dv">100</span>)</span>
<span id="cb275-2"><a href="simulations-und-programmierübungen-in-r.html#cb275-2" aria-hidden="true" tabindex="-1"></a>bmark <span class="ot">&lt;-</span> bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb275-3"><a href="simulations-und-programmierübungen-in-r.html#cb275-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">iterations =</span> <span class="dv">1000</span>,</span>
<span id="cb275-4"><a href="simulations-und-programmierübungen-in-r.html#cb275-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">forX2 =</span> <span class="fu">for_chisq</span>(m),</span>
<span id="cb275-5"><a href="simulations-und-programmierübungen-in-r.html#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">matX2 =</span> <span class="fu">mat_chisq</span>(m),</span>
<span id="cb275-6"><a href="simulations-und-programmierübungen-in-r.html#cb275-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">RX2 =</span> <span class="fu">unname</span>(<span class="fu">chisq.test</span>(m)<span class="sc">$</span>statistic)</span>
<span id="cb275-7"><a href="simulations-und-programmierübungen-in-r.html#cb275-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb275-8"><a href="simulations-und-programmierübungen-in-r.html#cb275-8" aria-hidden="true" tabindex="-1"></a>bmark <span class="sc">%&gt;%</span> </span>
<span id="cb275-9"><a href="simulations-und-programmierübungen-in-r.html#cb275-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">&#39;violin&#39;</span>)</span></code></pre></div>
<img src="Robustheit_files/figure-html/unnamed-chunk-111-1.png" width="672" />
</details>
<p>Als letztes baue einen chi-Quadrat-Test auf Unabhängigkeit mit der <span class="math inline">\(\chi^2\)</span>-Statistik aus unseren Funktionen durchführt und die Originalmatrix mit Randsummen, die Gesamtzahl an Beobachtungen, die Teststatistik, die Freiheitsgrade und das p<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> zurückgibt.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="simulations-und-programmierübungen-in-r.html#cb276-1" aria-hidden="true" tabindex="-1"></a>my_chisq.test <span class="ot">&lt;-</span> <span class="cf">function</span>(m){</span>
<span id="cb276-2"><a href="simulations-und-programmierübungen-in-r.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">statistic =</span> <span class="fu">mat_chisq</span>(m))</span>
<span id="cb276-3"><a href="simulations-und-programmierübungen-in-r.html#cb276-3" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(m, <span class="fu">colSums</span>(m))</span>
<span id="cb276-4"><a href="simulations-und-programmierübungen-in-r.html#cb276-4" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mat, <span class="fu">rowSums</span>(mat))</span>
<span id="cb276-5"><a href="simulations-und-programmierübungen-in-r.html#cb276-5" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>mat <span class="ot">&lt;-</span> mat</span>
<span id="cb276-6"><a href="simulations-und-programmierübungen-in-r.html#cb276-6" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>n <span class="ot">&lt;-</span> mat[<span class="fu">nrow</span>(mat), <span class="fu">ncol</span>(mat)]</span>
<span id="cb276-7"><a href="simulations-und-programmierübungen-in-r.html#cb276-7" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>df <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(m)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">*</span> (<span class="fu">ncol</span>(m) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb276-8"><a href="simulations-und-programmierübungen-in-r.html#cb276-8" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>p <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(out<span class="sc">$</span>statistic,</span>
<span id="cb276-9"><a href="simulations-und-programmierübungen-in-r.html#cb276-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">df =</span> out<span class="sc">$</span>df,</span>
<span id="cb276-10"><a href="simulations-und-programmierübungen-in-r.html#cb276-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lower.tail =</span> F)</span>
<span id="cb276-11"><a href="simulations-und-programmierübungen-in-r.html#cb276-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb276-12"><a href="simulations-und-programmierübungen-in-r.html#cb276-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb276-13"><a href="simulations-und-programmierübungen-in-r.html#cb276-13" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb276-14"><a href="simulations-und-programmierübungen-in-r.html#cb276-14" aria-hidden="true" tabindex="-1"></a><span class="fu">my_chisq.test</span>(m)</span></code></pre></div>
<pre><code>## $statistic
## [1] 0.46875
## 
## $mat
##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   12
## [2,]    2    5    8   15
## [3,]    3    6    9   18
## [4,]    6   15   24   45
## 
## $n
## [1] 45
## 
## $df
## [1] 4
## 
## $p
## [1] 0.976471</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="simulations-und-programmierübungen-in-r.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(m)</span></code></pre></div>
<pre><code>## Warning in chisq.test(m): Chi-squared approximation may be incorrect</code></pre>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  m
## X-squared = 0.46875, df = 4, p-value = 0.9765</code></pre>
</details>
<p>Als kleinen Zusatz könnt Ihr Euch noch überlegen, wie Ihr eine eigene print-Funktion für Euren Test schreiben könntet.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="simulations-und-programmierübungen-in-r.html#cb281-1" aria-hidden="true" tabindex="-1"></a>my_chisq.test <span class="ot">&lt;-</span> <span class="cf">function</span>(m){</span>
<span id="cb281-2"><a href="simulations-und-programmierübungen-in-r.html#cb281-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">statistic =</span> <span class="fu">mat_chisq</span>(m))</span>
<span id="cb281-3"><a href="simulations-und-programmierübungen-in-r.html#cb281-3" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(m, <span class="fu">colSums</span>(m))</span>
<span id="cb281-4"><a href="simulations-und-programmierübungen-in-r.html#cb281-4" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mat, <span class="fu">rowSums</span>(mat))</span>
<span id="cb281-5"><a href="simulations-und-programmierübungen-in-r.html#cb281-5" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>mat <span class="ot">&lt;-</span> mat</span>
<span id="cb281-6"><a href="simulations-und-programmierübungen-in-r.html#cb281-6" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>n <span class="ot">&lt;-</span> mat[<span class="fu">nrow</span>(mat), <span class="fu">ncol</span>(mat)]</span>
<span id="cb281-7"><a href="simulations-und-programmierübungen-in-r.html#cb281-7" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>df <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(m)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">*</span> (<span class="fu">ncol</span>(m) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb281-8"><a href="simulations-und-programmierübungen-in-r.html#cb281-8" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>p <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(out<span class="sc">$</span>statistic,</span>
<span id="cb281-9"><a href="simulations-und-programmierübungen-in-r.html#cb281-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">df =</span> out<span class="sc">$</span>df,</span>
<span id="cb281-10"><a href="simulations-und-programmierübungen-in-r.html#cb281-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lower.tail =</span> F)</span>
<span id="cb281-11"><a href="simulations-und-programmierübungen-in-r.html#cb281-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributes</span>(out)<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="st">&#39;my_chisqtest&#39;</span></span>
<span id="cb281-12"><a href="simulations-und-programmierübungen-in-r.html#cb281-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb281-13"><a href="simulations-und-programmierübungen-in-r.html#cb281-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb281-14"><a href="simulations-und-programmierübungen-in-r.html#cb281-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-15"><a href="simulations-und-programmierübungen-in-r.html#cb281-15" aria-hidden="true" tabindex="-1"></a>print.my_chisqtest <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...){</span>
<span id="cb281-16"><a href="simulations-und-programmierübungen-in-r.html#cb281-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&#39;Chi-Quadrat-Test auf Unabhängigkeit&#39;</span>)</span>
<span id="cb281-17"><a href="simulations-und-programmierübungen-in-r.html#cb281-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb281-18"><a href="simulations-und-programmierübungen-in-r.html#cb281-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&#39;Chi^2_(&#39;</span>,x<span class="sc">$</span>df,<span class="st">&#39;) = &#39;</span>,x<span class="sc">$</span>statistic,<span class="st">&#39;; p = &#39;</span>,x<span class="sc">$</span>p, <span class="at">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb281-19"><a href="simulations-und-programmierübungen-in-r.html#cb281-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n\n</span><span class="st">&#39;</span>)</span>
<span id="cb281-20"><a href="simulations-und-programmierübungen-in-r.html#cb281-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&#39;Der Test ist damit auf 5%-Niveau&#39;</span>,</span>
<span id="cb281-21"><a href="simulations-und-programmierübungen-in-r.html#cb281-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(x<span class="sc">$</span>p<span class="sc">&lt;</span>.<span class="dv">05</span>,<span class="st">&#39; &#39;</span>,<span class="st">&#39; nicht &#39;</span>),</span>
<span id="cb281-22"><a href="simulations-und-programmierübungen-in-r.html#cb281-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;signifikant!&#39;</span>, <span class="at">sep =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb281-23"><a href="simulations-und-programmierübungen-in-r.html#cb281-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb281-24"><a href="simulations-und-programmierübungen-in-r.html#cb281-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-25"><a href="simulations-und-programmierübungen-in-r.html#cb281-25" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb281-26"><a href="simulations-und-programmierübungen-in-r.html#cb281-26" aria-hidden="true" tabindex="-1"></a><span class="fu">my_chisq.test</span>(m)</span></code></pre></div>
<pre><code>## Chi-Quadrat-Test auf Unabhängigkeit
## Chi^2_(4) = 0.46875; p = 0.976471
## 
## Der Test ist damit auf 5%-Niveau nicht signifikant!</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="simulations-und-programmierübungen-in-r.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(m)</span></code></pre></div>
<pre><code>## Warning in chisq.test(m): Chi-squared approximation may be incorrect</code></pre>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  m
## X-squared = 0.46875, df = 4, p-value = 0.9765</code></pre>
</details>
<style>
pre.numberSource code > span > a:first-child::before {
  left: -0.3em;
}
</style>
</div>
<div id="t-test" class="section level2">
<h2>t-Test</h2>
<p>Erstelle eine Funktion <code>my_dkw</code>, die für einen gegebenen Vektor <code>x</code> deskriptive Kennwerte als Liste zurückgibt.
Diese Liste soll die Stichprobengröße<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>, den Mittelwert und die Varianz beinhalten.
Mit einem optionalen Argument <code>corrected</code> soll angegeben werden können, ob die korrigierte oder die unkorrigierte Stichprobenvarianz ausgegeben werden soll.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="simulations-und-programmierübungen-in-r.html#cb286-1" aria-hidden="true" tabindex="-1"></a>my_dkw <span class="ot">&lt;-</span> <span class="cf">function</span>(x,<span class="at">corrected=</span><span class="cn">FALSE</span>){ </span>
<span id="cb286-2"><a href="simulations-und-programmierübungen-in-r.html#cb286-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)                  </span>
<span id="cb286-3"><a href="simulations-und-programmierübungen-in-r.html#cb286-3" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)<span class="sc">/</span>n                     </span>
<span id="cb286-4"><a href="simulations-und-programmierübungen-in-r.html#cb286-4" aria-hidden="true" tabindex="-1"></a>  sqa <span class="ot">&lt;-</span> <span class="fu">sum</span>((x<span class="sc">-</span>m)<span class="sc">^</span><span class="dv">2</span>)                 </span>
<span id="cb286-5"><a href="simulations-und-programmierübungen-in-r.html#cb286-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> sqa<span class="sc">/</span><span class="fu">ifelse</span>(corrected, n<span class="dv">-1</span>, n)  </span>
<span id="cb286-6"><a href="simulations-und-programmierübungen-in-r.html#cb286-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">n =</span> n,<span class="at">m =</span> m, <span class="at">v =</span> var))</span>
<span id="cb286-7"><a href="simulations-und-programmierübungen-in-r.html#cb286-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Mit Hilfe der vorangehenden Funktion soll nun ein rechtsseitiger Zwei-Stichproben-t-Test für unabhängige Stichproben bei vorausgesetzter Varianzhomogenität geschrieben werden.</p>
<p>Zur Erinnerung hier die Formel:</p>
<p><span class="math display">\[t={\frac {{M_2}-{M_1}}{\sqrt{\frac{\vphantom{(s_1^2}n_1+n_2}{n_1n_2}}\sqrt{{\frac  {(n_1-1)s_{1}^{2}+(n_2-1)s_{2}^{2}}{\vphantom{n^2}n_1+n_2-2}}}}}\]</span></p>
<p>Als Argumente werden die Vektoren der beiden Stichproben eingegeben, die zu testende Vermutung soll sein, dass der zur ersten Stichprobe gehörende Erwartungswert größer ist als der zur zweiten Stichprobe gehörende.</p>
<details>
<summary>
Antwort
</summary>
<p>Hier eine mögliche Realisierung:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="simulations-und-programmierübungen-in-r.html#cb287-1" aria-hidden="true" tabindex="-1"></a>my_t_test0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x1,x2){      <span class="co"># (1)</span></span>
<span id="cb287-2"><a href="simulations-und-programmierübungen-in-r.html#cb287-2" aria-hidden="true" tabindex="-1"></a>  dkw1 <span class="ot">&lt;-</span> <span class="fu">my_dkw</span>(x1)                <span class="co"># (2)</span></span>
<span id="cb287-3"><a href="simulations-und-programmierübungen-in-r.html#cb287-3" aria-hidden="true" tabindex="-1"></a>  dkw2 <span class="ot">&lt;-</span> <span class="fu">my_dkw</span>(x2)</span>
<span id="cb287-4"><a href="simulations-und-programmierübungen-in-r.html#cb287-4" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> dkw1<span class="sc">$</span>n                      <span class="co"># (3)</span></span>
<span id="cb287-5"><a href="simulations-und-programmierübungen-in-r.html#cb287-5" aria-hidden="true" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> dkw2<span class="sc">$</span>n</span>
<span id="cb287-6"><a href="simulations-und-programmierübungen-in-r.html#cb287-6" aria-hidden="true" tabindex="-1"></a>  S1q <span class="ot">&lt;-</span> dkw1<span class="sc">$</span>v                     <span class="co"># (4)</span></span>
<span id="cb287-7"><a href="simulations-und-programmierübungen-in-r.html#cb287-7" aria-hidden="true" tabindex="-1"></a>  S2q <span class="ot">&lt;-</span> dkw2<span class="sc">$</span>v</span>
<span id="cb287-8"><a href="simulations-und-programmierübungen-in-r.html#cb287-8" aria-hidden="true" tabindex="-1"></a>  sq <span class="ot">&lt;-</span> (n1 <span class="sc">*</span> S1q <span class="sc">+</span> n2 <span class="sc">*</span> S2q)<span class="sc">/</span>(n1<span class="sc">+</span>n2<span class="dv">-2</span>)    <span class="co"># (5)</span></span>
<span id="cb287-9"><a href="simulations-und-programmierübungen-in-r.html#cb287-9" aria-hidden="true" tabindex="-1"></a>  vf <span class="ot">&lt;-</span> (n1<span class="sc">+</span>n2)<span class="sc">/</span>(n1<span class="sc">*</span>n2)             <span class="co"># (6)</span></span>
<span id="cb287-10"><a href="simulations-und-programmierübungen-in-r.html#cb287-10" aria-hidden="true" tabindex="-1"></a>  nenner <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(vf<span class="sc">*</span>sq)             <span class="co"># (7)</span></span>
<span id="cb287-11"><a href="simulations-und-programmierübungen-in-r.html#cb287-11" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> (dkw1<span class="sc">$</span>m<span class="sc">-</span>dkw2<span class="sc">$</span>m)<span class="sc">/</span>nenner       <span class="co"># (8)</span></span>
<span id="cb287-12"><a href="simulations-und-programmierübungen-in-r.html#cb287-12" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> n1<span class="sc">+</span>n2<span class="dv">-2</span>                     <span class="co"># (9)</span></span>
<span id="cb287-13"><a href="simulations-und-programmierübungen-in-r.html#cb287-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pt</span>(t,df))                <span class="co"># (10)</span></span>
<span id="cb287-14"><a href="simulations-und-programmierübungen-in-r.html#cb287-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Anmerkungen:</p>
<ol style="list-style-type: decimal">
<li><p>Als Argumente werden die beiden Stichprobenvektoren eingegeben. Der Test ist in dieser Form nicht richtig befriedigend, daher die 0 am Namen. Ihre Aufgabe ist es später, die Funktion so zu modifizieren (dann mit einem anderen Namen), dass sie Ihren Wünschen entspricht. In der Funktion werden die einzelnen Bestandteile des t-Bruchs ermittelt und am Ende zusammengebaut.</p></li>
<li><p>Die Kennwerte der ersten Stichprobe werden ermittelt, in der nächsten Zeile die der zweiten.</p></li>
<li><p>Die Länge der ersten Stichprobe wird extrahiert, da diese Länge häufiger vorkommt, ist ein kürzerer Name praktisch. Natürlich hätte man diese Zeile auch weglassen können; dann hätte man n1 im Folgenden überall durch dkw1$n ersetzten müssen. Entsprechend in der nächsten Zeile für die zweite Stichprobe.</p></li>
<li><p>Die Varianz der ersten Stichprobe wird extrahiert; sie bekommt den kürzeren Namen S1q (q für Quadrat), ausnahmsweise ist der erste Buchstabe groß, um daran zu erinnern, dass es die “normale” Varianz <span class="math inline">\(S_1^2\)</span> und nicht die korrigierte Stichprobenvarianz <span class="math inline">\(s_1^2\)</span> ist. Entsprechend die nächste Zeile für die zweite Stichprobe.</p></li>
<li><p>Hier wird <span class="math inline">\(s^2\)</span> ausgerechnet. Die Rechnung entspricht nicht der Standardformel, das Ergebnis ist aber dasselbe wegen <span class="math inline">\(nS^2=(n-1)s^2\)</span>. Der Vorteil des Rechnens mit <span class="math inline">\(S^2\)</span> ist der, dass hier auch eine Stichprobe einen Umfang von 1 haben kann, erst wenn beide Stichproben Umfang 1 haben, entsteht ein Problem. Ein Teil der Verbesserung könnte sein, dieses Problem abzufangen und durch eine print-Ausgabe darauf hinzuweisen.</p></li>
<li><p>Der Vorfaktor im Nenner.</p></li>
<li><p>Der Nenner.</p></li>
<li><p>Der t-Bruch.</p></li>
<li><p>Die Freiheitsgrade</p></li>
<li><p>Ergebnis ist der p-Wert des rechtsseitigen Tests.</p></li>
</ol>
</details>
<p>Aufgaben:</p>
<ol style="list-style-type: decimal">
<li>Stellen Sie sich vor, die Funktion würde nicht das richtige Ergebnis liefern. Fügen Sie Anweisungen ein, mit denen Sie die Zwischenresultate kontrollieren können um so einen möglichen Fehler zu finden!</li>
</ol>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="simulations-und-programmierübungen-in-r.html#cb288-1" aria-hidden="true" tabindex="-1"></a>my_t_test0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x1,x2){      </span>
<span id="cb288-2"><a href="simulations-und-programmierübungen-in-r.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  dkw1 <span class="ot">&lt;-</span> <span class="fu">my_dkw</span>(x1)                </span>
<span id="cb288-3"><a href="simulations-und-programmierübungen-in-r.html#cb288-3" aria-hidden="true" tabindex="-1"></a>  dkw2 <span class="ot">&lt;-</span> <span class="fu">my_dkw</span>(x2)</span>
<span id="cb288-4"><a href="simulations-und-programmierübungen-in-r.html#cb288-4" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> dkw1<span class="sc">$</span>n                      </span>
<span id="cb288-5"><a href="simulations-und-programmierübungen-in-r.html#cb288-5" aria-hidden="true" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> dkw2<span class="sc">$</span>n</span>
<span id="cb288-6"><a href="simulations-und-programmierübungen-in-r.html#cb288-6" aria-hidden="true" tabindex="-1"></a>  S1q <span class="ot">&lt;-</span> dkw1<span class="sc">$</span>v                     </span>
<span id="cb288-7"><a href="simulations-und-programmierübungen-in-r.html#cb288-7" aria-hidden="true" tabindex="-1"></a>  S2q <span class="ot">&lt;-</span> dkw2<span class="sc">$</span>v</span>
<span id="cb288-8"><a href="simulations-und-programmierübungen-in-r.html#cb288-8" aria-hidden="true" tabindex="-1"></a>  sq <span class="ot">&lt;-</span> (n1 <span class="sc">*</span> S1q <span class="sc">+</span> n2 <span class="sc">*</span> S2q)<span class="sc">/</span>(n1<span class="sc">+</span>n2<span class="dv">-2</span>)    </span>
<span id="cb288-9"><a href="simulations-und-programmierübungen-in-r.html#cb288-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(sq)</span>
<span id="cb288-10"><a href="simulations-und-programmierübungen-in-r.html#cb288-10" aria-hidden="true" tabindex="-1"></a>  vf <span class="ot">&lt;-</span> (n1<span class="sc">+</span>n2)<span class="sc">/</span>(n1<span class="sc">*</span>n2)             </span>
<span id="cb288-11"><a href="simulations-und-programmierübungen-in-r.html#cb288-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(vf)</span>
<span id="cb288-12"><a href="simulations-und-programmierübungen-in-r.html#cb288-12" aria-hidden="true" tabindex="-1"></a>  nenner <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(vf<span class="sc">*</span>sq)             </span>
<span id="cb288-13"><a href="simulations-und-programmierübungen-in-r.html#cb288-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(nenner)</span>
<span id="cb288-14"><a href="simulations-und-programmierübungen-in-r.html#cb288-14" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> (dkw1<span class="sc">$</span>m<span class="sc">-</span>dkw2<span class="sc">$</span>m)<span class="sc">/</span>nenner       </span>
<span id="cb288-15"><a href="simulations-und-programmierübungen-in-r.html#cb288-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(t)</span>
<span id="cb288-16"><a href="simulations-und-programmierübungen-in-r.html#cb288-16" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> n1<span class="sc">+</span>n2<span class="dv">-2</span>                     </span>
<span id="cb288-17"><a href="simulations-und-programmierübungen-in-r.html#cb288-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pt</span>(t,df))                </span>
<span id="cb288-18"><a href="simulations-und-programmierübungen-in-r.html#cb288-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<ol start="2" style="list-style-type: decimal">
<li>Kontrollieren Sie das Ergebnis des t-Tests auf Folie 73 der Einführung! Die Daten dazu sind nicht explizit gegeben, lassen sich aber aus den Histogrammen auf Folie 46 (bis auf die unwesentliche Reihenfolge) leicht rekonstruieren (beachte: es handelt sich jeweils um 20 Werte). Bei der Herstellung der Datenvektoren kann der Ausdruck <code>rep(bin_value, times = n_per_bin)</code> nützlich sein, mit <code>my_dkw</code> können Sie die Kennwerte der Stichproben überprüfen. Achtung: die Konvention bei der Differenz der Mittelwerte ist auf den Folien anders als hier!</li>
</ol>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="simulations-und-programmierübungen-in-r.html#cb289-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">c</span>(.<span class="dv">05</span>,.<span class="dv">2</span>,.<span class="dv">5</span>,.<span class="dv">15</span>,.<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">20</span>)</span>
<span id="cb289-2"><a href="simulations-und-programmierübungen-in-r.html#cb289-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>(.<span class="dv">1</span>,.<span class="dv">05</span>,.<span class="dv">25</span>,.<span class="dv">2</span>,.<span class="dv">3</span>,.<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">20</span>)</span>
<span id="cb289-3"><a href="simulations-und-programmierübungen-in-r.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="fu">my_dkw</span>(x)</span></code></pre></div>
<pre><code>## $n
## [1] 20
## 
## $m
## [1] 2.05
## 
## $v
## [1] 0.9475</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="simulations-und-programmierübungen-in-r.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_dkw</span>(y)</span></code></pre></div>
<pre><code>## $n
## [1] 20
## 
## $m
## [1] 2.85
## 
## $v
## [1] 2.0275</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="simulations-und-programmierübungen-in-r.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_t_test0</span>(y,x)</span></code></pre></div>
<pre><code>## [1] 1.565789
## [1] 0.1
## [1] 0.3957006
## [1] 2.021731</code></pre>
<pre><code>## [1] 0.02514363</code></pre>
</details>
<ol start="3" style="list-style-type: decimal">
<li>Das Ergebnis ist unbefriedigend, da Sie ja nur am p-Wert erkennen können, ob der Test signifikant ist. Ändern Sie daher die Funktion geeignet ab, so dass weitere Kennwerte des Tests ausgegeben werden, benutzen Sie beispielsweise die Möglichkeiten einer Liste.</li>
</ol>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="simulations-und-programmierübungen-in-r.html#cb296-1" aria-hidden="true" tabindex="-1"></a>my_t_test0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x1,x2){      </span>
<span id="cb296-2"><a href="simulations-und-programmierübungen-in-r.html#cb296-2" aria-hidden="true" tabindex="-1"></a>  dkw1 <span class="ot">&lt;-</span> <span class="fu">my_dkw</span>(x1)                </span>
<span id="cb296-3"><a href="simulations-und-programmierübungen-in-r.html#cb296-3" aria-hidden="true" tabindex="-1"></a>  dkw2 <span class="ot">&lt;-</span> <span class="fu">my_dkw</span>(x2)</span>
<span id="cb296-4"><a href="simulations-und-programmierübungen-in-r.html#cb296-4" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> dkw1<span class="sc">$</span>n                      </span>
<span id="cb296-5"><a href="simulations-und-programmierübungen-in-r.html#cb296-5" aria-hidden="true" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> dkw2<span class="sc">$</span>n</span>
<span id="cb296-6"><a href="simulations-und-programmierübungen-in-r.html#cb296-6" aria-hidden="true" tabindex="-1"></a>  S1q <span class="ot">&lt;-</span> dkw1<span class="sc">$</span>v                     </span>
<span id="cb296-7"><a href="simulations-und-programmierübungen-in-r.html#cb296-7" aria-hidden="true" tabindex="-1"></a>  S2q <span class="ot">&lt;-</span> dkw2<span class="sc">$</span>v</span>
<span id="cb296-8"><a href="simulations-und-programmierübungen-in-r.html#cb296-8" aria-hidden="true" tabindex="-1"></a>  sq <span class="ot">&lt;-</span> (n1 <span class="sc">*</span> S1q <span class="sc">+</span> n2 <span class="sc">*</span> S2q)<span class="sc">/</span>(n1<span class="sc">+</span>n2<span class="dv">-2</span>)    </span>
<span id="cb296-9"><a href="simulations-und-programmierübungen-in-r.html#cb296-9" aria-hidden="true" tabindex="-1"></a>  vf <span class="ot">&lt;-</span> (n1<span class="sc">+</span>n2)<span class="sc">/</span>(n1<span class="sc">*</span>n2)    </span>
<span id="cb296-10"><a href="simulations-und-programmierübungen-in-r.html#cb296-10" aria-hidden="true" tabindex="-1"></a>  nenner <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(vf<span class="sc">*</span>sq)    </span>
<span id="cb296-11"><a href="simulations-und-programmierübungen-in-r.html#cb296-11" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> (dkw1<span class="sc">$</span>m<span class="sc">-</span>dkw2<span class="sc">$</span>m)<span class="sc">/</span>nenner  </span>
<span id="cb296-12"><a href="simulations-und-programmierübungen-in-r.html#cb296-12" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> n1<span class="sc">+</span>n2<span class="dv">-2</span>                     </span>
<span id="cb296-13"><a href="simulations-und-programmierübungen-in-r.html#cb296-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">p =</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">pt</span>(t,df),</span>
<span id="cb296-14"><a href="simulations-und-programmierübungen-in-r.html#cb296-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">t =</span> t,</span>
<span id="cb296-15"><a href="simulations-und-programmierübungen-in-r.html#cb296-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">df =</span> df))                </span>
<span id="cb296-16"><a href="simulations-und-programmierübungen-in-r.html#cb296-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<ol start="4" style="list-style-type: decimal">
<li>Unbefriedigend ist auch, dass nur ein rechtsseitiger Test gerechnet werden kann. Ändern Sie die Funktion daher weiter so ab, dass auch linksseitige oder zweiseitige Tests möglich sind (Sie müssen dann ein weiteres Argument hinzufügen, mit dem Sie der Funktion Ihre Wünsche bekanntgeben, in der Funktion können Sie dann beispielsweise mit if - else arbeiten).</li>
</ol>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb297"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb297-1"><a href="simulations-und-programmierübungen-in-r.html#cb297-1"></a>my_t_test0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x1,x2, <span class="at">alternative =</span> <span class="st">&#39;two.sided&#39;</span>){      </span>
<span id="cb297-2"><a href="simulations-und-programmierübungen-in-r.html#cb297-2"></a>  dkw1 <span class="ot">&lt;-</span> <span class="fu">my_dkw</span>(x1)                </span>
<span id="cb297-3"><a href="simulations-und-programmierübungen-in-r.html#cb297-3"></a>  dkw2 <span class="ot">&lt;-</span> <span class="fu">my_dkw</span>(x2)</span>
<span id="cb297-4"><a href="simulations-und-programmierübungen-in-r.html#cb297-4"></a>  n1 <span class="ot">&lt;-</span> dkw1<span class="sc">$</span>n                      </span>
<span id="cb297-5"><a href="simulations-und-programmierübungen-in-r.html#cb297-5"></a>  n2 <span class="ot">&lt;-</span> dkw2<span class="sc">$</span>n</span>
<span id="cb297-6"><a href="simulations-und-programmierübungen-in-r.html#cb297-6"></a>  S1q <span class="ot">&lt;-</span> dkw1<span class="sc">$</span>v                     </span>
<span id="cb297-7"><a href="simulations-und-programmierübungen-in-r.html#cb297-7"></a>  S2q <span class="ot">&lt;-</span> dkw2<span class="sc">$</span>v</span>
<span id="cb297-8"><a href="simulations-und-programmierübungen-in-r.html#cb297-8"></a>  sq <span class="ot">&lt;-</span> (n1 <span class="sc">*</span> S1q <span class="sc">+</span> n2 <span class="sc">*</span> S2q)<span class="sc">/</span>(n1<span class="sc">+</span>n2<span class="dv">-2</span>)    </span>
<span id="cb297-9"><a href="simulations-und-programmierübungen-in-r.html#cb297-9"></a>  vf <span class="ot">&lt;-</span> (n1<span class="sc">+</span>n2)<span class="sc">/</span>(n1<span class="sc">*</span>n2)    </span>
<span id="cb297-10"><a href="simulations-und-programmierübungen-in-r.html#cb297-10"></a>  nenner <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(vf<span class="sc">*</span>sq)    </span>
<span id="cb297-11"><a href="simulations-und-programmierübungen-in-r.html#cb297-11"></a>  t <span class="ot">&lt;-</span> (dkw1<span class="sc">$</span>m<span class="sc">-</span>dkw2<span class="sc">$</span>m)<span class="sc">/</span>nenner  </span>
<span id="cb297-12"><a href="simulations-und-programmierübungen-in-r.html#cb297-12"></a>  df <span class="ot">&lt;-</span> n1<span class="sc">+</span>n2<span class="dv">-2</span>   </span>
<span id="cb297-13"><a href="simulations-und-programmierübungen-in-r.html#cb297-13"></a>  <span class="cf">if</span>(<span class="fu">substr</span>(alternative,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;t&#39;</span>,<span class="st">&#39;T&#39;</span>)){</span>
<span id="cb297-14"><a href="simulations-und-programmierübungen-in-r.html#cb297-14"></a>    p <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(t),df,<span class="at">lower.tail =</span> F)</span>
<span id="cb297-15"><a href="simulations-und-programmierübungen-in-r.html#cb297-15"></a>  }<span class="cf">else</span>{ </span>
<span id="cb297-16"><a href="simulations-und-programmierübungen-in-r.html#cb297-16"></a>    p <span class="ot">&lt;-</span> <span class="fu">pt</span>(t,df,</span>
<span id="cb297-17"><a href="simulations-und-programmierübungen-in-r.html#cb297-17"></a>            <span class="at">lower.tail =</span> <span class="fu">substr</span>(alternative,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;l&#39;</span>,<span class="st">&#39;L&#39;</span>))</span>
<span id="cb297-18"><a href="simulations-und-programmierübungen-in-r.html#cb297-18"></a>  }</span>
<span id="cb297-19"><a href="simulations-und-programmierübungen-in-r.html#cb297-19"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">p =</span> p,</span>
<span id="cb297-20"><a href="simulations-und-programmierübungen-in-r.html#cb297-20"></a>              <span class="at">t =</span> t,</span>
<span id="cb297-21"><a href="simulations-und-programmierübungen-in-r.html#cb297-21"></a>              <span class="at">df =</span> df))                </span>
<span id="cb297-22"><a href="simulations-und-programmierübungen-in-r.html#cb297-22"></a>}</span>
<span id="cb297-23"><a href="simulations-und-programmierübungen-in-r.html#cb297-23"></a><span class="fu">my_t_test0</span>(x,y)</span></code></pre></div>
<pre><code>## $p
## [1] 0.05028725
## 
## $t
## [1] -2.021731
## 
## $df
## [1] 38</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb299-1"><a href="simulations-und-programmierübungen-in-r.html#cb299-1"></a><span class="fu">t.test</span>(x,y)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  x and y
## t = -2.0217, df = 33.575, p-value = 0.05123
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.604535247  0.004535247
## sample estimates:
## mean of x mean of y 
##      2.05      2.85</code></pre>
<table class=" lightable-classic lightable-classic-2" style="font-size: 15px; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Zeile
</th>
<th style="text-align:left;">
Was passiert?
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1-12
</td>
<td style="text-align:left;">
Alles wie gehabt, nur die p-Wert-Berechnung ändert sich
</td>
</tr>
<tr>
<td style="text-align:left;">
13
</td>
<td style="text-align:left;">
Wenn der erste Buchstabe t oder T ist, soll…
</td>
</tr>
<tr>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
…der rechsseitige-Wert des Betrags von t verdoppelt zurückgegeben werden.
</td>
</tr>
<tr>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
Sonst…
</td>
</tr>
<tr>
<td style="text-align:left;">
16
</td>
<td style="text-align:left;">
.. soll der p-Wert (mit Vorzeichen) genommen werden…
</td>
</tr>
<tr>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
…und bei der t-Verteilung links abgeschnitten werden wenn die alternative mit l oder L anfängt. Als anderen Fall bleibt ja nur eine rechtsseitige Hypothese übrig, was lower.tail=F entspricht.
</td>
</tr>
</tbody>
</table>
</details>
<ol start="5" style="list-style-type: decimal">
<li>Schreiben Sie eine ähnliche Funktion für den Einstichproben-t-Test<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>; hier ist als weiteres Argument der Erwartungswert unter H0 einzugeben, der vielleicht standardmäßig 0 ist.</li>
</ol>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="simulations-und-programmierübungen-in-r.html#cb301-1" aria-hidden="true" tabindex="-1"></a>my_t_test1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">mu0 =</span> <span class="dv">0</span>, <span class="at">alternative =</span> <span class="st">&#39;two.sided&#39;</span>){      </span>
<span id="cb301-2"><a href="simulations-und-programmierübungen-in-r.html#cb301-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb301-3"><a href="simulations-und-programmierübungen-in-r.html#cb301-3" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb301-4"><a href="simulations-und-programmierübungen-in-r.html#cb301-4" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(n) <span class="sc">*</span> (m<span class="sc">-</span>mu0)<span class="sc">/</span><span class="fu">sd</span>(x)</span>
<span id="cb301-5"><a href="simulations-und-programmierübungen-in-r.html#cb301-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> n<span class="dv">-1</span>  </span>
<span id="cb301-6"><a href="simulations-und-programmierübungen-in-r.html#cb301-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">substr</span>(alternative,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;t&#39;</span>,<span class="st">&#39;T&#39;</span>)){</span>
<span id="cb301-7"><a href="simulations-und-programmierübungen-in-r.html#cb301-7" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(t),df,<span class="at">lower.tail =</span> F)</span>
<span id="cb301-8"><a href="simulations-und-programmierübungen-in-r.html#cb301-8" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{ </span>
<span id="cb301-9"><a href="simulations-und-programmierübungen-in-r.html#cb301-9" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">pt</span>(t,df,</span>
<span id="cb301-10"><a href="simulations-und-programmierübungen-in-r.html#cb301-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower.tail =</span> <span class="fu">substr</span>(alternative,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;l&#39;</span>,<span class="st">&#39;L&#39;</span>))</span>
<span id="cb301-11"><a href="simulations-und-programmierübungen-in-r.html#cb301-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb301-12"><a href="simulations-und-programmierübungen-in-r.html#cb301-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">p =</span> p,</span>
<span id="cb301-13"><a href="simulations-und-programmierübungen-in-r.html#cb301-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">t =</span> t,</span>
<span id="cb301-14"><a href="simulations-und-programmierübungen-in-r.html#cb301-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">df =</span> df))                </span>
<span id="cb301-15"><a href="simulations-und-programmierübungen-in-r.html#cb301-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<ol start="6" style="list-style-type: decimal">
<li>Schreiben Sie eine ähnliche Funktion für den Zweistichproben-t-Test mit abhängigen Stichproben. Hier könnte es sich empfehlen, die Daten in Form einer Matrix einzugeben. Sinnvollerweise benutzen Sie nach Differenzbildung dann die Funktion für den Einstichproben-t-Test aus (5).</li>
</ol>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="simulations-und-programmierübungen-in-r.html#cb302-1" aria-hidden="true" tabindex="-1"></a>my_t_test1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">mu0 =</span> <span class="dv">0</span>, <span class="at">alternative =</span> <span class="st">&#39;two.sided&#39;</span>){ </span>
<span id="cb302-2"><a href="simulations-und-programmierübungen-in-r.html#cb302-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.matrix</span>(x) <span class="sc">|</span> <span class="fu">is.data.frame</span>(x)){</span>
<span id="cb302-3"><a href="simulations-und-programmierübungen-in-r.html#cb302-3" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x[,<span class="dv">1</span>] <span class="sc">-</span> x[,<span class="dv">2</span>]</span>
<span id="cb302-4"><a href="simulations-und-programmierübungen-in-r.html#cb302-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb302-5"><a href="simulations-und-programmierübungen-in-r.html#cb302-5" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb302-6"><a href="simulations-und-programmierübungen-in-r.html#cb302-6" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb302-7"><a href="simulations-und-programmierübungen-in-r.html#cb302-7" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(n) <span class="sc">*</span> (m<span class="sc">-</span>mu0)<span class="sc">/</span><span class="fu">sd</span>(x)</span>
<span id="cb302-8"><a href="simulations-und-programmierübungen-in-r.html#cb302-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> n<span class="dv">-1</span>  </span>
<span id="cb302-9"><a href="simulations-und-programmierübungen-in-r.html#cb302-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">substr</span>(alternative,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;t&#39;</span>,<span class="st">&#39;T&#39;</span>)){</span>
<span id="cb302-10"><a href="simulations-und-programmierübungen-in-r.html#cb302-10" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(t),df,<span class="at">lower.tail =</span> F)</span>
<span id="cb302-11"><a href="simulations-und-programmierübungen-in-r.html#cb302-11" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{ </span>
<span id="cb302-12"><a href="simulations-und-programmierübungen-in-r.html#cb302-12" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">pt</span>(t,df,</span>
<span id="cb302-13"><a href="simulations-und-programmierübungen-in-r.html#cb302-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower.tail =</span> <span class="fu">substr</span>(alternative,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;l&#39;</span>,<span class="st">&#39;L&#39;</span>))</span>
<span id="cb302-14"><a href="simulations-und-programmierübungen-in-r.html#cb302-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb302-15"><a href="simulations-und-programmierübungen-in-r.html#cb302-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">p =</span> p,</span>
<span id="cb302-16"><a href="simulations-und-programmierübungen-in-r.html#cb302-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">t =</span> t,</span>
<span id="cb302-17"><a href="simulations-und-programmierübungen-in-r.html#cb302-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">df =</span> df))                </span>
<span id="cb302-18"><a href="simulations-und-programmierübungen-in-r.html#cb302-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<ol start="7" style="list-style-type: decimal">
<li>[Zusatz] Schreiben Sie eine Wrapper-Funktion, die auf eine von Ihnen gewählte Variante (Argumente, besonderes Input-Format,…) den zu rechnenden t-Test aus den gerade erstellten Funktionen auswählt und durchführt. Richten Sie Ihre Funktion so ein, dass sie sowohl mit Datensätzen als auch mit Matrizen und Vektoren für x umgehen kann. Wenn x zwei Dimensionen hat, soll y ignoriert werden. Außerdem soll ein Argument übergeben werden, dass für zwei Eingaben angibt, ob der Test abhängig oder unabhängig durchgeführt werden soll.</li>
</ol>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="simulations-und-programmierübungen-in-r.html#cb303-1" aria-hidden="true" tabindex="-1"></a>my_t_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x,</span>
<span id="cb303-2"><a href="simulations-und-programmierübungen-in-r.html#cb303-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb303-3"><a href="simulations-und-programmierübungen-in-r.html#cb303-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mu0 =</span> <span class="dv">0</span>,</span>
<span id="cb303-4"><a href="simulations-und-programmierübungen-in-r.html#cb303-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">alternative =</span> <span class="st">&#39;two.sided&#39;</span>, </span>
<span id="cb303-5"><a href="simulations-und-programmierübungen-in-r.html#cb303-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">paired =</span> F){</span>
<span id="cb303-6"><a href="simulations-und-programmierübungen-in-r.html#cb303-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.matrix</span>(x) <span class="sc">|</span> <span class="fu">is.data.frame</span>(x)){</span>
<span id="cb303-7"><a href="simulations-und-programmierübungen-in-r.html#cb303-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(paired){</span>
<span id="cb303-8"><a href="simulations-und-programmierübungen-in-r.html#cb303-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">my_t_test1</span>(x, <span class="at">mu0 =</span> mu0, <span class="at">alternative =</span> alternative)</span>
<span id="cb303-9"><a href="simulations-und-programmierübungen-in-r.html#cb303-9" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb303-10"><a href="simulations-und-programmierübungen-in-r.html#cb303-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">my_t_test0</span>(x[,<span class="dv">1</span>], x[,<span class="dv">2</span>],<span class="at">alternative =</span> alternative)</span>
<span id="cb303-11"><a href="simulations-und-programmierübungen-in-r.html#cb303-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb303-12"><a href="simulations-und-programmierübungen-in-r.html#cb303-12" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb303-13"><a href="simulations-und-programmierübungen-in-r.html#cb303-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(y)){</span>
<span id="cb303-14"><a href="simulations-und-programmierübungen-in-r.html#cb303-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(paired){</span>
<span id="cb303-15"><a href="simulations-und-programmierübungen-in-r.html#cb303-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">my_t_test1</span>(<span class="fu">cbind</span>(x,y), <span class="at">alternative =</span> alternative)</span>
<span id="cb303-16"><a href="simulations-und-programmierübungen-in-r.html#cb303-16" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb303-17"><a href="simulations-und-programmierübungen-in-r.html#cb303-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">my_t_test0</span>(x, y,<span class="at">alternative =</span> alternative)</span>
<span id="cb303-18"><a href="simulations-und-programmierübungen-in-r.html#cb303-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb303-19"><a href="simulations-und-programmierübungen-in-r.html#cb303-19" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb303-20"><a href="simulations-und-programmierübungen-in-r.html#cb303-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">my_t_test1</span>(x, <span class="at">mu0 =</span> mu0, <span class="at">alternative =</span> alternative)</span>
<span id="cb303-21"><a href="simulations-und-programmierübungen-in-r.html#cb303-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb303-22"><a href="simulations-und-programmierübungen-in-r.html#cb303-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb303-23"><a href="simulations-und-programmierübungen-in-r.html#cb303-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Kontrollieren Sie Ihre Funktionen immer an kleinen Datensätzen, in denen Sie auch von Hand rechnen können, beispielsweise können Sie Aufgaben aus QM2 benutzen.
Alternativ können Sie auch größere Datensätze nutzen und Ihre Funktion mit der bekannten t-Test Funktion vergleichen. Achten Sie dabei aber darauf, dass Sie im unabhängigen Fall <code>var.equal</code> auf <code>TRUE</code> setzen.</p>
<!-- ## t-Vertrauensintervall -->
<!-- Hier gleich die Funktion: -->
<!-- ```{r} -->
<!-- my_t_vi <- function(x,p=.95){       # (1) -->
<!--   dkw <- my_dkw(x, corrected = T)   # (2) -->
<!--   n <- dkw$n                        # (3) -->
<!--   tfrak <- qt(1-(1-p)/2, n-1)       # (4) -->
<!--   sem <- sqrt(dkw$v/n)              # (5) -->
<!--   hb <- tfrak * sem                 # (6) -->
<!--   return(c(dkw$m-hb,dkw$m+hb))      # (7) -->
<!-- } -->
<!-- ``` -->
<!-- Anmerkungen: -->
<!-- (1) Argumente sind der Datenvektor x und das gewünschte Niveau p, hier mit .95 vorbelegt. -->
<!-- (2) Die Kennwerte der Daten, gleich wird mit der korrigierten Stichprobenvarianz gerechnet. -->
<!-- (3) Stichprobenumfang, kommt öfter vor, daher ist ein kürzerer Name praktisch. -->
<!-- (4) Das alpha/2-Fraktil (alpha ist 1-p). -->
<!-- (5) Der SEM. -->
<!-- (6) Die halbe Breite. -->
<!-- (7) Ergebnis: Vektor aus unterer und oberer Grenze des Vertrauensintervalls. -->
<!-- Aufgabe: Prüfen Sie an bekannten Daten (beispielsweise Einleitung Folie 61) nach, ob die Funktion das richtige Intervall liefert! -->
<!-- ### Zufallsstichproben mit diskreten Werten -->
<!-- Die passende Funktion ist hier sample. Beispiel: -->
<!-- ```{r} -->
<!-- sample(seq(6), 20, replace = T) -->
<!-- ``` -->
<!-- Hier wird eine Zufallsstichprobe aus den Zahlen von 1 bis 6 gezogen (seq(6)), deren Umfang 20 ist, wobei Zahlen auch mehrfach gezogen werden können (replace = T, Achtung: Standardwert ist F, siehe Hilfe). Hier wird also eine zufällige Serie von 20 Würfelergebnissen erzeugt. -->
<!-- Etwas komplizierter: Das Wahrnehmungsexperiment aus dem 1. Semester, die Wahrscheinlichkeiten der möglichen Fehlerzahlen von 0 bis 5 seien durch die W-Funktion Folie 77 gegeben. Es sollen 20 Werte erzeugt werden: -->
<!-- ```{r} -->
<!-- sample(seq(6)-1, 20, replace = T, prob = c(.1,.15,.35,.25,.1,.05)) -->
<!-- ``` -->
<!-- Hier sind die möglichen Werte die Zahlen von 0 bis 5, die man beispielsweise durch seq(6)-1 erhält. Möglich wäre auch -->
<!-- `seq(from = 0, to = 5)` -->
<!-- kürzer -->
<!-- `seq(0, 5)` -->
<!-- oder noch einfacher -->
<!-- `0:5` -->
<!-- Zusätzlich werden durch den Parameter prob die Wahrscheinlichkeiten dieser Zahlen angegeben. -->
<!-- Wenn diese Verteilung öfter gebraucht wird, ist es sinnvoll, den Vektor der Wahrscheinlichkeiten unter einem geeigneten Namen abzuspeichern, um dann nur noch diesen Namen in die Anweisung einsetzen zu müssen, entsprechend für den Vektor möglicher Werte. -->
<!-- Zu prüfen ist nun, ob die "Zufallsstichproben" auch den Forderungen entsprechen; dazu sollen bei einer großen derartigen Stichprobe die relativen Häufigkeiten der möglichen Werte ermittelt werden, die dann hoffentlich etwa gleich den vorgegebenen Wahrscheinlichkeiten sind. -->
<!-- Obwohl R bessere Möglichkeiten zur Verfügung stellt, soll zur Übung das Auszählen mit primitive Mitteln bewerkstelligt werden. Zunächst: Wie oft kommt ein Element a in einem Vektor x vor? -->
<!-- ```{r} -->
<!-- anzahl <- function(a, x){        # (1) -->
<!--   l <- length(x) -->
<!--   z <- 0                         # (2) -->
<!--   for(i in seq_len(l)){ -->
<!--     if(x[i] == a) z <- z + 1     # (3) -->
<!--   } -->
<!--   return(z) -->
<!-- } -->
<!-- ``` -->
<!-- Anmerkungen: -->
<!-- (1) Die Argumente der Funktion sind das untersuchte Element a und der Vektor x. -->
<!-- (2) Eine Zählvariable z wird eingerichtet, der Wert dieses "Zählers" z wird auf 0 gesetzt -->
<!-- (3) Nacheinander werden die Komponenten von x untersucht, bei Übereinstimmung mit a wird der Zähler um 1 erhöht -->
<!-- Tabelle der relativen Häufigkeiten: -->
<!-- ```{r} -->
<!-- v2trh <- function(w, x){         # (1) -->
<!--   n <- length(x) -->
<!--   ah <- rep(0,length(w))         # (2) -->
<!--   for(i in seq(length(w))) -->
<!--     { -->
<!--     ah[i] <- anzahl(w[i],x)      # (3) -->
<!--   } -->
<!--   return(rbind(w,ah/n))          # (4) -->
<!-- } -->
<!-- ``` -->
<!-- Anmerkungen: -->
<!-- (1) Name: Vektor zu Tabelle relativer Häufigkeiten, Argumente: w: mögliche Werte, x: untersuchter Vektor. Wichtig ist, dass w alle Werte enthält, die in x vorkommen können, sonst ist die Summe der "relativen Häufigkeiten" am Ende nicht 1. -->
<!-- (2) in ah werden die absoluten Häufigkeiten der Werte in w abgespeichert, Vorbelegung mit Nullen. -->
<!-- (3) Für jeden möglichen Wert wird in ah die Häufigkeit des Auftretens eingetragen. -->
<!-- (4) Das Ergebnis ist eine Matrix, die hier dadurch entsteht, dass man die beiden Vektoren w und ah/n als Zeilen (r: row) zusammenfügt. -->
<!-- Beispiel: -->
<!-- Funktioniert die Erzeugung von zufälligen Würfelergebnissen einigermaßen? Es soll 10000 Mal gewürfelt werden, die Tabelle der relativen Häufigkeiten ist dann zu untersuchen! Achtung: Es sollte unbedingt verhindert werden, dass das Ergebnis des Würfelns ausgegeben wird! Dazu wird das Ergebnis gleich in einer Variable abgespeichert. -->
<!-- ```{r} -->
<!-- x <- sample(seq(6),10000,replace = T) -->
<!-- v2trh(seq(6),x) -->
<!-- ``` -->
<!-- Bemerkung: Ein erneuter Aufruf liefert natürlich wieder andere relative Häufigkeiten. -->
<!-- Auch beim Umfang 100000 geht übrigens es sehr schnell! -->
<!-- Aufgabe: -->
<!-- Untersuchen Sie die gleiche Frage für das zweite Beispiel des Wahrnehmungsexperiments! -->
<!-- ### Eine Simulation zum Vertrauensintervall -->
<!-- Einführungsfolie 67: Wie wahrscheinlich ist es beim Würfeln, dass das t-Vertrauensintervall zum Niveau .95 auf der Basis von Stichproben vom Umfang 60 den Erwartungswert 3.5 enthält? Die Wahrscheinlichkeit soll durch Simulationen abgeschätzt werden (da die Würfelergebnisse nicht normalverteilt sind, ist eine der Voraussetzungen für das t-Vertrauensintervall eigentlich nicht gegeben). -->
<!-- Vielleicht ist es praktisch, die Prüfung, ob eine Zahl in einem Intervall liegt, auszulagern: -->
<!-- ```{r} -->
<!-- istin <- function(x, i, gr = F){       # (1) -->
<!--   ug <- i[1]                           # (2) -->
<!--   og <- i[2] -->
<!--   wug <- if(gr) x >= ug else x > ug    # (3) -->
<!--   wog <- if(gr) x <= og else x < og -->
<!--   return(wug & wog)                    # (4) -->
<!-- } -->
<!-- ``` -->
<!-- Anmerkungen; -->
<!-- (1) x ist ein Wert, i ein Intervall, gegeben durch einen Vektor aus unterer und oberer Grenze. Es soll die Frage beantwortet werden, ob x in dem Intervall liegt. Der Parameter gr gibt an, ob die Grenzen zum Intervall dazugehören (T) oder nicht. -->
<!-- (2) Die untere Intervallgrenze, nächste Zeile die obere -->
<!-- (3) Die Variable wug enthält einen logischen Wert: T, wenn x größer bzw. größer/gleich der unteren Intervallgrenze ist, F sonst. Beachte: x\>=ug ist ein logischer Wert, T, wenn x\>= ug richtig ist, F sonst. -->
<!-- (4) Zurückgegeben wird die Und-Verknüpfung von wug und wog, die nur dann T ist, wenn wug und wog beide T sind, sonst F. -->
<!-- Nun ist die Simulation einfach, der Umfang der Einzelstichproben und der Umfang der Simulation sind wählbar: -->
<!-- ```{r} -->
<!-- w_vi_simul <- function(n, N, p = .95){    # (1) -->
<!--   z <- 0                                  # (2) -->
<!--   for(i in seq(N)){                       # (3) -->
<!--     s <- sample(seq(6),n,replace = T)     # (4) -->
<!--     vi <- my_t_vi(s,p)                    # (5) -->
<!--     if(istin(3.5,vi)) z = z + 1           # (5) -->
<!--   } -->
<!--   return(z/N)                             # (7) -->
<!-- } -->
<!-- ``` -->
<!-- Anmerkungen: -->
<!-- (1) Der Name soll für Würfel-Vertrauensintervall-Simulation stehen, n ist der Stichprobenumfang der Einzelstichproben, N ist der Umfang der Simulation, p ist das Niveau für das Vertrauensintervall. -->
<!-- (2) Wieder ein Zähler z. -->
<!-- (3) Die Schleife für die Gesamtsimulation vom Umfang N. -->
<!-- (4) Es wird jeweils eine Zufallsstichprobe s von n Würfelergebnissen erzeugt. -->
<!-- (5) Das t-Vertrauensintervall vi zum Niveau p wird gebildet. -->
<!-- (6) Wenn der (hier bekannte) Erwartungswert von 3.5 in dem Intervall liegt, wird z um 1 vergrößert. -->
<!-- (7) Ausgegeben wird die relative Häufigkeit der Fälle, in denen das Vertrauensintervall den Erwartungswert 3.5 enthält. -->
<!-- Zahlen wie auf Folie 67 erhält man jetzt mit w_vi_simul(60,10000). Wieder kommt das Ergebnis ziemlich schnell. -->
<!-- Wenn Sie die Funktion mit denselben Argumenten zweimal aufrufen, werden Sie praktisch immer unterschiedliche Ergebnisse bekommen, da ja jedes Mal neue Zufallsstichproben gezogen werden. -->
<!-- Um schnell mehrere Ergebnisse zu erhalten, können Sie den Befehl unten in der Konsole eingeben; nachdem das Ergebnis bestimmt ist, holen Sie den Befehl mit Pfeiltaste nach oben wieder zurück und können ihn dann gleich noch einmal ausführen. Auch im Source-Fenster gibt es eine solche Möglichkeit: Ctrl-Alt-P führt den letzten Befehl noch einmal aus. Die Shortcuts finden Sie übrigens im Menü unter Help oder direkt mit Alt-Shift-K. -->
<!-- ### Simulationen zum Wahrnehmungsexperiment -->
<!-- Im ersten Semester wurden auch Simulationen zum Verhalten des t-Tests bei dem fiktiven Wahrnehmungsexperiment gemacht (Folie 78, dann ab Folie 82). Hier waren die Variablen (Fehlerzahl) diskret, daher ist es fraglich, ob man den t-Test dennoch verwenden kann (es geht also um die Robustheit). -->
<!-- Hier zunächst eine neue Version des t-Tests: -->
<!-- ```{r} -->
<!-- my_t_test1 <- function(x1,x2,n1,n2,df,vf){      # (1) -->
<!--   m1 <- sum(x1)/n1                              # (2)          -->
<!--   m2 <- sum(x2)/n2 -->
<!--   sqa1 <- sum((x1-m1)^2)                        # (3)            -->
<!--   sqa2 <- sum((x2-m2)^2)                  -->
<!--   sq <- (sqa1 + sqa2)/df                        # (4) -->
<!--   nenner <- sqrt(vf*sq)          -->
<!--   t <- (m1-m2)/nenner -->
<!--   return(t) -->
<!-- } -->
<!-- ``` -->
<!-- Die Funktion ist von früher einigermaßen bekannt, es gibt aber Veränderungen und es fehlen Teile. -->
<!-- Anmerkungen: -->
<!-- (1) Die Argumente x1 und x2 stehen für die beiden Stichproben, als weitere Argumente werden die Stichprobengrößen n1 und n2, die Anzahl der Freiheitsgrade df und der Vorfaktor vf des Nenners übergeben. Diese Zahlen müssen also außerhalb der Funktion bestimmt werden. Das scheint erstmal nicht besonders sinnvoll zu sein. In der Simulation wird diese Funktion jedoch immer wieder aufgerufen, wobei die vier zusätzlichen Argumente immer gleich groß sind. Wenn diese Zahlen immer wieder neu bestimmt werden müssten, würde das Zeit kosten, daher sollen sie außerhalb der Funktion nur einmal berechnet und dann übergeben werden. Die Zeitersparnis ist in diesem Fall allerdings minimal, hier soll nur auf die Möglichkeit hingewiesen werden, dass man bei komplizierteren zeitintensiven Rechnungen, die immer wieder auftreten, auf diese Art manchmal merklich Zeit sparen kann. -->
<!-- (2) Die Mittelwerte werden jetzt in der Funktion berechnet, n1 wird als Argument übergeben. -->
<!-- (3) Auch die Summen der quadrierten Abweichungen vom Mittelwert werden in der Funktion berechnet, nicht aber die Varianzen. Die Varianzen werden ja eigentlich nicht gebraucht, da im Zähler von $s^2$ gerade die Summe dieser beiden Summen steht, wie man sich leicht überzeugt. Man erspart sich so die nutzlose Division und anschließende Multiplikation mit der jeweiligen Stichprobengröße (auch hier ist der Zeitgewinn minimal, es soll aber auf die Möglichkeit von Zeitersparnis in komplizierteren Situationen aufmerksam gemacht werden). -->
<!-- (4) Auch die Zahl df der in der Simulation immer gleichen Freiheitsgrade und der einheitliche Vorfaktor vf im Nenner (nächste Zeile) müssen außerhalb bestimmt und als Argumente übergeben werden. -->
<!-- Aufgabe: Überzeugen Sie sich an einem Beispiel, dass der t-Wert korrekt bestimmt wird; Sie müssen dann vorher die Variablen n1, n2, df und vf korrekt belegen. -->
<!-- Der Übersichtlichkeit halber kann man auch die Bildung der Zufallsstichproben zu einer eigenen Funktion machen: -->
<!-- ```{r} -->
<!-- z_stpr_w <- function(n, w){   -->
<!--   sample(0:5, n, replace = T, prob=w) -->
<!-- } -->
<!-- ``` -->
<!-- Anmerkung: Da die Fehlerzahl immer eine Zahl zwischen 0 und 5 ist, kann dies Argument weggelassen werden. Als Argumente bleiben die Stichprobengröße n und der Vektor w der Wahrscheinlichkeiten dieser Zahlen. z_stpr_w soll Zufallsstichprobe Wahrnehmung abkürzen. -->
<!-- Nun die Funktion, die mit Hilfe einer Simulation die Wahrscheinlichkeit eines signifikanten Ergebnisses zu schätzen versucht: -->
<!-- ```{r} -->
<!-- we_t_simul <- function(N,n1,w1,n2,w2,a = .05){           # (1) -->
<!--   df <- n1 + n2 - 2                                      # (2) -->
<!--   vf <- (n1 + n2)/(n1 * n2) -->
<!--   kw <- qt(a,df)                                         # (3) -->
<!--   z <- 0                                                 # (4) -->
<!--   for(i in seq(N)){                                      # (5) -->
<!--     x1 <- z_stpr_w(n1,w1)                                # (6) -->
<!--     x2 <- z_stpr_w(n2,w2) -->
<!--     if(my_t_test1(x1,x2,n1,n2,df,vf) <= kw) z <- z + 1   # (7) -->
<!--   } -->
<!--   z/N                                                    # (8) -->
<!-- } -->
<!-- ``` -->
<!-- Anmerkungen: -->
<!-- (1) Der Funktionsname steht für Wahrnehmungsexperiment-t-Test-Simulation. Die Argumente sind: Die Zahl N der Simulationen, der Umfang n1 der ersten Stichprobe (auf den Folien die Kontrollgruppe), die Verteilung w1 der möglichen Fehlerzahlen in der Kontrollgruppe, entsprechend n2 und w2 für die zweite Stichprobe (die Alkoholgruppe), außerdem das Signifikanzniveau a, standardmäßig .05. -->
<!-- (2) Die Zahl der Freiheitsgrade wird ein für alle Mal bestimmt, ebenso in der nächsten Zeile der Vorfaktor. Das bringt hier zwar keinen merklichen Vorteil, ähnliches Vorgehen in anderen Zusammenhängen manchmal schon. -->
<!-- (3) Der kritische Wert kw. Achtung: Im Gegensatz zu den Folien wird hier linksseitig getestet, da die Konventionen hier anders sind (Mittelwertdifferenz M1-M2 und nicht M2-M1). -->
<!-- (4) Es wird wieder ein Zähler eingerichtet und auf 0 gesetzt. -->
<!-- (5) Die Schleife der Simulation. -->
<!-- (6) Die erste Stichprobe (Kontrollgruppe), nächste Zeile die zweite. -->
<!-- (7) Der t-Test, wenn er linksseitig signifikant wird, wird der Zähler erhöht. -->
<!-- (8) Ausgabe der relativen Häufigkeit signifikanter Ergebnisse. -->
<!-- Es folgen einige Verteilungen aus den Folien: -->
<!-- ```{r} -->
<!-- w1 <- c(.1,.15,.35,.25,.1,.05) -->
<!-- w2 <- c(.05,.1,.25,.3,.2,.1) -->
<!-- w2a <- c(.05,.05,.1,.15,.25,.4) -->
<!-- ``` -->
<!-- Simulation Folie 79: -->
<!-- ```{r} -->
<!-- we_t_simul(10000,20,w1,20,w1) -->
<!-- ``` -->
<!-- Untersuchung von $\beta$ (Folie 82): -->
<!-- ```{r} -->
<!-- 1-we_t_simul(10000,20,w1,20,w2) -->
<!-- ``` -->
<!-- Hier geht es um die nichtsignifikanten Ergebnisse, daher "1-..." -->
<!-- Erstes Beispiel Folie 83: -->
<!-- ```{r} -->
<!-- 1-we_t_simul(10000,20,w1,20,w2,.1) -->
<!-- ``` -->
<!-- Aufgabe: Überzeugen Sie sich, dass die weiteren Ergebnisse auf den Folien zur Untersuchung von $\beta$ einigermaßen mit den Ergebnissen dieses Programms übereinstimmen! -->
<!-- Interessant ist dann noch das Beispiel auf Folie 92, hier zunächst die Verteilungen: -->
<!-- ```{r} -->
<!-- w1x <- c(0,0,.5,.5,0,.0) -->
<!-- w2x <- c(.5,0,0,0,0,.5) -->
<!-- ``` -->
<!-- Das Ergebnis bekommen Sie mit -->
<!-- ```{r} -->
<!-- we_t_simul(10000,20,w1x,5,w2x) -->
<!-- ``` -->

</div>
</div>
<div class="footnotes">
<hr />
<ol start="7">
<li id="fn7"><p>wenn Du nicht willst<a href="simulations-und-programmierübungen-in-r.html#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>In unserem Fall müssen wir die Teststatistik mit der <span class="math inline">\(\chi^2_{(I-1)(J-1)}\)</span>-Verteilung vergleichen, die R-Funktion für das Finden eines gegebenen <span class="math inline">\(\chi^2\)</span>-Perzentils ist <code>pchisq()</code><a href="simulations-und-programmierübungen-in-r.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>Länge des Vektors<a href="simulations-und-programmierübungen-in-r.html#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Als Erinnerung, die Formel für die unter der <span class="math inline">\(H_0\)</span> <span class="math inline">\(t_{n-1}\)</span>-verteilte Teststatistik ist <span class="math inline">\(t = \frac{M_x - \mu_0}{s_x/\sqrt{n}}\)</span><a href="simulations-und-programmierübungen-in-r.html#fnref10" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functionals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="experimente-in-psychopy.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Robustheit.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
