<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Functionals | Robustheit</title>
  <meta name="description" content="Seminar zur Vertiefung psychologischer Methodenlehre - Robustheit und Voraussetzungstests" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Functionals | Robustheit" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Seminar zur Vertiefung psychologischer Methodenlehre - Robustheit und Voraussetzungstests" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Functionals | Robustheit" />
  
  <meta name="twitter:description" content="Seminar zur Vertiefung psychologischer Methodenlehre - Robustheit und Voraussetzungstests" />
  

<meta name="author" content="Max Brede und Johannes Andres" />


<meta name="date" content="2021-10-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="attribute.html"/>
<link rel="next" href="literatur.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Robustheit und Voraussetzungstests</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Vorwort</a></li>
<li class="chapter" data-level="" data-path="lehrplan.html"><a href="lehrplan.html"><i class="fa fa-check"></i>Lehrplan</a>
<ul>
<li class="chapter" data-level="" data-path="lehrplan.html"><a href="lehrplan.html#semesterplan"><i class="fa fa-check"></i>Semesterplan</a></li>
</ul></li>
<li class="part"><span><b>I Programmieren in R</b></span></li>
<li class="chapter" data-level="" data-path="funktionen.html"><a href="funktionen.html"><i class="fa fa-check"></i>Funktionen</a>
<ul>
<li class="chapter" data-level="" data-path="funktionen.html"><a href="funktionen.html#geschachtelte-funktionen"><i class="fa fa-check"></i>Geschachtelte Funktionen</a></li>
<li class="chapter" data-level="" data-path="funktionen.html"><a href="funktionen.html#optionale-argumente"><i class="fa fa-check"></i>Optionale Argumente</a></li>
</ul></li>
<li><a href="if-statements.html#if-statements"><code>if</code>-Statements</a></li>
<li class="chapter" data-level="" data-path="zufallswerte.html"><a href="zufallswerte.html"><i class="fa fa-check"></i>Zufallswerte</a></li>
<li class="chapter" data-level="" data-path="schleifen.html"><a href="schleifen.html"><i class="fa fa-check"></i>Schleifen</a></li>
<li class="chapter" data-level="" data-path="listen.html"><a href="listen.html"><i class="fa fa-check"></i>Listen</a>
<ul>
<li class="chapter" data-level="" data-path="listen.html"><a href="listen.html#listen-und-datensätze"><i class="fa fa-check"></i>Listen und Datensätze</a></li>
<li class="chapter" data-level="" data-path="listen.html"><a href="listen.html#arbeiten-mit-listen"><i class="fa fa-check"></i>Arbeiten mit Listen</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="attribute.html"><a href="attribute.html"><i class="fa fa-check"></i>Attribute</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i>Functionals</a>
<ul>
<li><a href="functionals.html#purrrmap"><code>purrr::map</code></a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exkurs-iteratoren-vergleich"><i class="fa fa-check"></i>Exkurs: Iteratoren-Vergleich</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="literatur.html"><a href="literatur.html"><i class="fa fa-check"></i>Literatur</a></li>
<li class="divider"></li>
<li><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Robustheit</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functionals" class="section level1">
<h1>Functionals</h1>
<p>Wie wir am Anfang des Semesters bei der Definition unserer eigenen Funktionen ja schon gemerkt haben, sind Funktionen in R von der Struktur her gar nicht so verschieden zu anderen Objekten wie zum Beispiel Datensätzen oder Vektoren.</p>
<p>Sowohl die einen, wie auch die anderen, werden als Namen mit entsprechenden Inhalten im Environment angelegt, wobei aber natürlich bei Datensätzen die Daten damit gemeint sind und bei Funktionen <em>Environment</em>-Verweis, <em>Body</em> und <em>Formals</em> angelegt werden.</p>
<p>Das heißt für R aber auch, dass so genannte <em>Functionals</em> genutzt werden. Diese Gruppe von Funktionen sind solche, die andere Funktionen als Argumente und diese anwenden können. Beispiele für solche Funktionen haben wir auch schon kennen gelernt, die vielleicht aus dem Kapitel zur <a href="https://mbrede.github.io/CAU_Kiel_EDVI/aggregation-und-filemanagement.html">Aggregation</a> von Daten in EDV1 bekannte <code>across</code>-Funktion ist ein solcher Fall:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="functionals.html#cb166-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> </span>
<span id="cb166-2"><a href="functionals.html#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb166-3"><a href="functionals.html#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb166-4"><a href="functionals.html#cb166-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="fu">list</span>(<span class="at">m =</span> mean, <span class="at">s =</span> sd),</span>
<span id="cb166-5"><a href="functionals.html#cb166-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">&#39;{.fn}_{.col}&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 9
##   Species    m_Sepal.Length s_Sepal.Length m_Sepal.Width s_Sepal.Width
##   &lt;fct&gt;               &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1 setosa               5.01          0.352          3.43         0.379
## 2 versicolor           5.94          0.516          2.77         0.314
## 3 virginica            6.59          0.636          2.97         0.322
## # … with 4 more variables: m_Petal.Length &lt;dbl&gt;, s_Petal.Length &lt;dbl&gt;,
## #   m_Petal.Width &lt;dbl&gt;, s_Petal.Width &lt;dbl&gt;</code></pre>
<p>Hier übergeben wir dem <code>.fns</code>-Argument eine Liste mit Funktionen, die dann auf alle numerischen Spalten des Datensatzes angewandt werden.</p>
<p>Ein anderes, sehr für R typisches Beispiel von Functionals sind <code>sapply</code>, <code>lapply</code> und <code>mapply</code>. Alle drei Funktionen nehmen als Input eins oder mehrere Objekte und eine Funktion, die auf jeden Eintrag de(s/r) übergebenen Objekte(s) angewandt werden soll.</p>
<p>Exemplarisch gucken wir uns <code>sapply</code> an, die Listen<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> als erstes Argument erwarten.
Als Objekt nehmen wir <code>iris</code> (was ja wie wir gelernt habe eine aufgemotzte Liste ist) und lassen uns mit <code>sapply</code> für jede Spalte sagen, ob sie numerisch ist:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="functionals.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(iris, is.numeric)</span></code></pre></div>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species 
##         TRUE         TRUE         TRUE         TRUE        FALSE</code></pre>
<p>Fällt Dir was auf?
Wir haben gerade eine Funktion fünf mal ausgeführt, ohne ihr explizit ein Argument zu übergeben. Den (<code>is.numeric(iris$Sepal.Width)</code>,<code>is.numeric(iris$Sepal.Length)</code>, etc., etc., …)-Teil hat uns <code>sapply</code> abgenommen. <code>sapply</code> ist sogar so weit gegangen, uns die Ergebnisse in einem praktischen Vektor wiederzugeben, hat also irgendwie einen Output für uns erstellt.</p>
<p>Diesen Vektor könnten wir jetzt als Index nutzen, um uns nur die numerischen Spalten ausgeben zu lassen und uns wieder mit <code>sapply</code> die Mittelwerte ausrechnen zu lassen:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="functionals.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(iris[,<span class="fu">which</span>(<span class="fu">sapply</span>(iris, is.numeric))],</span>
<span id="cb170-2"><a href="functionals.html#cb170-2" aria-hidden="true" tabindex="-1"></a>       mean)</span></code></pre></div>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
##     5.843333     3.057333     3.758000     1.199333</code></pre>
<p>Die <code>sapply</code>-Funktion macht also im Prinzip nicht viel anderes, als unsere <code>for</code>-Schleifen.</p>
<div id="aufgabe-9" class="section level3">
<h3>Aufgabe</h3>
<p>Baue die oben mit <code>sapply</code> implementierte Mittlung mit <code>for</code>-Schleifen nach.
Dabei soll erst überprüft werden, ob eine Spalte numerische Inhalte hat, wenn dem so ist soll der Mittelwert dieser Spalte berechnet werden.
Verpacke deine Lösung in eine Funktion, die den spaltenweisen Mittelwert zurückgibt.</p>
<p>Überlege dir insbesondere, ob Du den Output-Vektor allozieren kannst und was ein sinnvolles Format dafür wäre.</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="functionals.html#cb172-1" aria-hidden="true" tabindex="-1"></a>my_col_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb172-2"><a href="functionals.html#cb172-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">ncol</span>(df))</span>
<span id="cb172-3"><a href="functionals.html#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(out) <span class="ot">&lt;-</span> <span class="fu">names</span>(df)</span>
<span id="cb172-4"><a href="functionals.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="fu">names</span>(df)){</span>
<span id="cb172-5"><a href="functionals.html#cb172-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.numeric</span>(df[[col]])){</span>
<span id="cb172-6"><a href="functionals.html#cb172-6" aria-hidden="true" tabindex="-1"></a>      out[col] <span class="ot">&lt;-</span> <span class="fu">mean</span>(df[[col]])</span>
<span id="cb172-7"><a href="functionals.html#cb172-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb172-8"><a href="functionals.html#cb172-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb172-9"><a href="functionals.html#cb172-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb172-10"><a href="functionals.html#cb172-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb172-11"><a href="functionals.html#cb172-11" aria-hidden="true" tabindex="-1"></a><span class="fu">my_col_mean</span>(iris)</span></code></pre></div>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species 
##     5.843333     3.057333     3.758000     1.199333           NA</code></pre>
</details>
</div>
<div id="purrrmap" class="section level2">
<h2><code>purrr::map</code></h2>
<p>Eine Alternative zu den <code>*apply</code>-Funktionen ist die <code>map</code>-Familie aus dem <code>purrr</code>-Paket. Im Prinzip sind die identisch zu den <code>*apply</code>-Funktionen, der große Unterschied ist, dass sie spezialisierter sind als erstere.</p>
<p>Diese Eigenschaft ist auch der einzige wirkliche Grund dafür, die functional-Iteratoren den Schleifen vorzuziehen. Code, der so spezifisch für ein Problem wie möglich ist, ist einfach schöner weil schneller verständlich.</p>
<p>Die grundlegende Funktion aus der <code>map</code>-Familie ist das einfache <code>map</code>, das <code>lapply</code>-Analogon. <code>map</code> nimmt also eine Liste oder einen Vektor und eine Funktion als Input und gibt eine Liste zurück:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="functionals.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, sqrt)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 1.414214
## 
## [[3]]
## [1] 1.732051
## 
## [[4]]
## [1] 2
## 
## [[5]]
## [1] 2.236068
## 
## [[6]]
## [1] 2.44949
## 
## [[7]]
## [1] 2.645751
## 
## [[8]]
## [1] 2.828427
## 
## [[9]]
## [1] 3
## 
## [[10]]
## [1] 3.162278</code></pre>
<p>Alternativ kann mit der sogenannten Funktionsschreibweise auch ein Ausdruck formuliert werden, der für jeden iterierten Wert ausgeführt werden soll:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="functionals.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">~</span><span class="fu">sqrt</span>(.))</span></code></pre></div>
<pre><code>##  [1] 1.000000 1.414214 1.732051 2.000000 2.236068 2.449490 2.645751 2.828427
##  [9] 3.000000 3.162278</code></pre>
<p>Der besondere Vorteil dieser Funktionen gegenüber den <code>*apply</code>-Funktionen, ist die Gruppe von Funktionen, die klar lesbar den erwarteten Output einer Iteration definieren.</p>
<p>Beispielsweise kann mit <code>map_dbl</code>, <code>map_lgl</code> und <code>map_chr</code> klar festgelegt werden, dass 1. ein <code>atomic</code>-Vektor ausgegeben wird, der 2. einen klaren Datentyp hat:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="functionals.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">~</span>.<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>##  [1]   1   4   9  16  25  36  49  64  81 100</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="functionals.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">~</span>.<span class="sc">%%</span><span class="dv">2</span><span class="sc">==</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>##  [1] FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="functionals.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_chr</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">~</span>letters[.])</span></code></pre></div>
<pre><code>##  [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot;</code></pre>
<p>Und, noch praktischer, auch für komplexere Datentypen gibt es Wrapper. So können wir zum Beispiel mit <code>map_dfr</code> und <code>map_dfc</code> <code>tibble</code>s erzeugen lassen, die dann aus zeilenweise (<code>df</code><em><code>r</code></em> für rows) und spaltenweise (<code>df</code><em><code>c</code></em> für columns) zusammengefügten Ergebnissen bestehen:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="functionals.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">~</span><span class="fu">tibble</span>(<span class="at">i =</span> .,</span>
<span id="cb184-2"><a href="functionals.html#cb184-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 2
##        i     x
##    &lt;int&gt; &lt;int&gt;
##  1     1    10
##  2     2     7
##  3     3     3
##  4     4     5
##  5     5     3
##  6     6     7
##  7     7     5
##  8     8    10
##  9     9     1
## 10    10     3</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="functionals.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfc</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">~</span><span class="fu">c</span>(<span class="fu">sample</span>(.<span class="sc">:</span>(.<span class="sc">+</span><span class="dv">10</span>),<span class="dv">1</span>)))</span></code></pre></div>
<pre><code>## New names:
## * NA -&gt; ...1
## * NA -&gt; ...2
## * NA -&gt; ...3
## * NA -&gt; ...4
## * NA -&gt; ...5
## * ...</code></pre>
<pre><code>## # A tibble: 1 × 10
##    ...1  ...2  ...3  ...4  ...5  ...6  ...7  ...8  ...9 ...10
##   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     5     8     3     4    15     9    11    15    13    10</code></pre>
</div>
<div id="exkurs-iteratoren-vergleich" class="section level2">
<h2>Exkurs: Iteratoren-Vergleich</h2>
<p>Man liest manchmal, dass loops in R wegen geringerer Geschwindigkeit in jedem Fall vermieden werden sollten. Das stimmt aber nicht wirklich, wenn man für seine <code>for</code>-Schleifen alloziert.</p>
<p>Um das zu zeigen vergleichen wir mit der folgenden Funktion <code>for</code> ohne Allokation, for mit Allokation, <code>sapply</code> und <code>map_dbl</code>:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="functionals.html#cb189-1" aria-hidden="true" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb189-2"><a href="functionals.html#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="functionals.html#cb189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-4"><a href="functionals.html#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="functionals.html#cb189-5" aria-hidden="true" tabindex="-1"></a>my_test <span class="ot">&lt;-</span> <span class="cf">function</span>(i){</span>
<span id="cb189-6"><a href="functionals.html#cb189-6" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb189-7"><a href="functionals.html#cb189-7" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;len&#39;</span>]] <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span>(i<span class="sc">%%</span><span class="dv">6</span>)</span>
<span id="cb189-8"><a href="functionals.html#cb189-8" aria-hidden="true" tabindex="-1"></a>  to_do <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>out[[<span class="st">&#39;len&#39;</span>]]</span>
<span id="cb189-9"><a href="functionals.html#cb189-9" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb189-10"><a href="functionals.html#cb189-10" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb189-11"><a href="functionals.html#cb189-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> to_do){</span>
<span id="cb189-12"><a href="functionals.html#cb189-12" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">c</span>(res, <span class="fu">my_function</span>(j))</span>
<span id="cb189-13"><a href="functionals.html#cb189-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb189-14"><a href="functionals.html#cb189-14" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;for ohne Allokation&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="sc">-</span> start</span>
<span id="cb189-15"><a href="functionals.html#cb189-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-16"><a href="functionals.html#cb189-16" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb189-17"><a href="functionals.html#cb189-17" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(to_do))</span>
<span id="cb189-18"><a href="functionals.html#cb189-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> to_do){</span>
<span id="cb189-19"><a href="functionals.html#cb189-19" aria-hidden="true" tabindex="-1"></a>    res[j] <span class="ot">&lt;-</span> <span class="fu">my_function</span>(j)</span>
<span id="cb189-20"><a href="functionals.html#cb189-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb189-21"><a href="functionals.html#cb189-21" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;for mit Allokation&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="sc">-</span> start</span>
<span id="cb189-22"><a href="functionals.html#cb189-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-23"><a href="functionals.html#cb189-23" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb189-24"><a href="functionals.html#cb189-24" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">sapply</span>(to_do, my_function)</span>
<span id="cb189-25"><a href="functionals.html#cb189-25" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;sapply&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="sc">-</span> start</span>
<span id="cb189-26"><a href="functionals.html#cb189-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-27"><a href="functionals.html#cb189-27" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb189-28"><a href="functionals.html#cb189-28" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(to_do, my_function)</span>
<span id="cb189-29"><a href="functionals.html#cb189-29" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;map_dbl&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="sc">-</span> start</span>
<span id="cb189-30"><a href="functionals.html#cb189-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb189-31"><a href="functionals.html#cb189-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="aufgabe-10" class="section level3">
<h3>Aufgabe</h3>
<p>Was passiert hier?</p>
<details>
<summary>
Antwort
</summary>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="functionals.html#cb190-1" aria-hidden="true" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span> <span class="co"># Funktion zum Quadrieren</span></span>
<span id="cb190-2"><a href="functionals.html#cb190-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-3"><a href="functionals.html#cb190-3" aria-hidden="true" tabindex="-1"></a>my_test <span class="ot">&lt;-</span> <span class="cf">function</span>(i){</span>
<span id="cb190-4"><a href="functionals.html#cb190-4" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># initiiere leere output-Liste</span></span>
<span id="cb190-5"><a href="functionals.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;len&#39;</span>]] <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span>(i<span class="sc">%%</span><span class="dv">6</span>) <span class="co"># Berechne Länge der Iteration als </span></span>
<span id="cb190-6"><a href="functionals.html#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 10-Potenz zwischen 0 und 5</span></span>
<span id="cb190-7"><a href="functionals.html#cb190-7" aria-hidden="true" tabindex="-1"></a>  to_do <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>out[[<span class="st">&#39;len&#39;</span>]] <span class="co"># durch zu iterierender Vektor</span></span>
<span id="cb190-8"><a href="functionals.html#cb190-8" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Startzeit erster Test</span></span>
<span id="cb190-9"><a href="functionals.html#cb190-9" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">c</span>() <span class="co"># initiiere leeren Vektor (keine Allokation)</span></span>
<span id="cb190-10"><a href="functionals.html#cb190-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> to_do){ <span class="co"># iteriere duch to_do</span></span>
<span id="cb190-11"><a href="functionals.html#cb190-11" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">c</span>(res, <span class="fu">my_function</span>(j)) <span class="co">#quadriere jede Zahl und </span></span>
<span id="cb190-12"><a href="functionals.html#cb190-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vergrößere res mit jeder Iteration</span></span>
<span id="cb190-13"><a href="functionals.html#cb190-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb190-14"><a href="functionals.html#cb190-14" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;for ohne Allokation&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="sc">-</span> start <span class="co"># berechne Zeit-delta</span></span>
<span id="cb190-15"><a href="functionals.html#cb190-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb190-16"><a href="functionals.html#cb190-16" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Startzeit zweiter Test</span></span>
<span id="cb190-17"><a href="functionals.html#cb190-17" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(to_do))<span class="co"># initiiere Vektor mit Allokation</span></span>
<span id="cb190-18"><a href="functionals.html#cb190-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> to_do){<span class="co"># iteriere durch to_do</span></span>
<span id="cb190-19"><a href="functionals.html#cb190-19" aria-hidden="true" tabindex="-1"></a>    res[j] <span class="ot">&lt;-</span> <span class="fu">my_function</span>(j) <span class="co">#quadriere jede Zahl und lege in res ab</span></span>
<span id="cb190-20"><a href="functionals.html#cb190-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb190-21"><a href="functionals.html#cb190-21" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;for mit Allokation&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="sc">-</span> start <span class="co"># berechne Zeit-delta</span></span>
<span id="cb190-22"><a href="functionals.html#cb190-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb190-23"><a href="functionals.html#cb190-23" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Startzeit dritter Test</span></span>
<span id="cb190-24"><a href="functionals.html#cb190-24" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">sapply</span>(to_do, my_function) <span class="co"># quadriere jede Zahl und speicher output</span></span>
<span id="cb190-25"><a href="functionals.html#cb190-25" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;sapply&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="sc">-</span> start <span class="co"># berechne Zeit-delta</span></span>
<span id="cb190-26"><a href="functionals.html#cb190-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb190-27"><a href="functionals.html#cb190-27" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Startzeit vierter Test</span></span>
<span id="cb190-28"><a href="functionals.html#cb190-28" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(to_do, my_function) <span class="co"># quadriere jede Zahl und speicher output</span></span>
<span id="cb190-29"><a href="functionals.html#cb190-29" aria-hidden="true" tabindex="-1"></a>  out[[<span class="st">&#39;map_dbl&#39;</span>]] <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="sc">-</span> start <span class="co"># berechne Zeit-delta</span></span>
<span id="cb190-30"><a href="functionals.html#cb190-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb190-31"><a href="functionals.html#cb190-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Diesen Test lassen wir 60 mal laufen, um ein paar Datenpunkte pro Länge und Iterator zu bekommen:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="functionals.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb191-2"><a href="functionals.html#cb191-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3"><a href="functionals.html#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession)</span>
<span id="cb191-4"><a href="functionals.html#cb191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5"><a href="functionals.html#cb191-5" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">future_map_dfr</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>, <span class="sc">~</span><span class="fu">my_test</span>(.))</span>
<span id="cb191-6"><a href="functionals.html#cb191-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-7"><a href="functionals.html#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(out,<span class="st">&#39;data/iterators.rds&#39;</span>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;len&#39;. You can override using the `.groups` argument.</code></pre>
<p><img src="Robustheit_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="5">
<li id="fn5"><p>oder Vektoren<a href="functionals.html#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="attribute.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="literatur.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Robustheit.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
